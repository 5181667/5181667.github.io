<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>心语 AI</title>
    <style>
        :root {
            --pink-primary: #FF9EC9;
            --pink-primary-rgb: 255, 158, 201;
            --pink-light: #FFF5F9;
            --pink-border: rgba(255, 158, 201, 0.3);

            --blue-primary: #4A90E2;
            --blue-primary-rgb: 74, 144, 226;
            --blue-light: #F5F9FF;
            --blue-border: rgba(74, 144, 226, 0.3);

            --theme-primary: var(--pink-primary);
            --theme-light: var(--pink-light);
            --theme-border: var(--pink-border);
            --theme-primary-rgb: var(--pink-primary-rgb);

            --text-primary: #333;
            --text-secondary: #666;
            --border-color: #eee;
        }

        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: #fff;
            position: relative;
            overflow-x: hidden;
        }

        /* 添加背景花纹 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                    radial-gradient(circle at 10% 20%, var(--theme-light) 0%, transparent 20%),
                    radial-gradient(circle at 90% 80%, var(--theme-light) 0%, transparent 20%),
                    radial-gradient(circle at 50% 50%, var(--theme-light) 0%, transparent 25%);
            opacity: 0.6;
            z-index: -1;
        }

        /* 装饰元素样式 */
        .decoration {
            position: fixed;
            pointer-events: none;
            z-index: -1;
        }

        .decoration-top-left {
            top: 0;
            left: 0;
            width: 200px;
            height: 200px;
            background:
                    radial-gradient(circle at 30% 30%, var(--theme-light) 0%, transparent 70%);
        }

        .decoration-bottom-right {
            bottom: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background:
                    radial-gradient(circle at 70% 70%, var(--theme-light) 0%, transparent 70%);
        }

        /* 浮动元素容器样式 */
        .floating-items {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .floating-item {
            position: absolute;
            opacity: 0.6;
            animation: float 20s linear infinite;
            will-change: transform;
        }

        /* 可爱模式的背景元素 */
        .floating-item.cute {
            font-size: 24px;
        }

        /* 专业模式的背景元素 */
        .floating-item.professional {
            font-size: 20px;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-50px) rotate(360deg);
                opacity: 0;
            }
        }

        /* 主容器样式更新 */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            z-index: 1;
        }

        /* 顶部标题区域 */
        .top-header {
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-img {
            height: 32px;
        }

        .logo h1 {
            font-size: 24px;
            margin: 0;
        }

        .subtitle {
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* AI助手信息 */
        .ai-profile {
            text-align: center;
            margin-bottom: 30px;
        }

        .ai-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 10px;
        }

        .ai-profile h2 {
            margin: 0;
            font-size: 20px;
        }

        .ai-profile p {
            color: var(--text-secondary);
            margin: 5px 0;
        }

        /* 模式切换 */
        .mode-switch {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }

        .mode-btn {
            padding: 6px 12px;
            border-radius: 15px;
            border: 1px solid var(--theme-primary);
            background: white;
            cursor: pointer;
        }

        .mode-btn.active {
            background: var(--theme-primary);
            color: white;
        }

        /* 聊天区域 */
        .chat-title {
            font-size: 16px;
            margin-bottom: 15px;
        }

        .chat-container {
            height: 400px;
            overflow-y: auto;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 12px rgba(var(--theme-primary-rgb), 0.1);
            border: 2px solid var(--theme-border);
            position: relative;
        }

        /* 添加内部装饰边框 */
        .chat-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 16px;
            background: linear-gradient(
                    135deg,
                    rgba(var(--theme-primary-rgb), 0.3) 0%,
                    rgba(var(--theme-primary-rgb), 0.1) 50%,
                    rgba(var(--theme-primary-rgb), 0.3) 100%
            );
            z-index: -1;
            pointer-events: none;
        }

        /* 可爱模式特殊装饰 */
        .container[data-mode="cute"] .chat-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(
                    90deg,
                    transparent 0%,
                    var(--theme-primary) 50%,
                    transparent 100%
            );
            opacity: 0.5;
            border-radius: 16px 16px 0 0;
        }

        /* 专业模式特殊装饰 */
        .container[data-mode="professional"] .chat-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(
                    180deg,
                    transparent 0%,
                    var(--theme-primary) 50%,
                    transparent 100%
            );
            opacity: 0.5;
            border-radius: 16px 0 0 16px;
        }

        /* 滚动条美化 */
        .chat-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: var(--theme-light);
            border-radius: 3px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: var(--theme-primary);
            border-radius: 3px;
            opacity: 0.6;
        }

        /* 移动端适配 */
        @media screen and (max-width: 768px) {
            .chat-container {
                border-radius: 12px;
                padding: 15px;
                margin-bottom: 15px;
            }

            .chat-container::before {
                border-radius: 12px;
            }
        }

        /* 快捷操作区 */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background: white;
            cursor: pointer;
            white-space: nowrap;
        }

        /* 输入区域 */
        .input-area {
            display: flex;
            gap: 10px;
        }

        .input-field {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            resize: none;
            height: 40px;
            font-size: 14px;
        }

        .send-btn {
            padding: 0 20px;
            border: none;
            border-radius: 20px;
            background: var(--theme-primary);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            height: 40px;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            opacity: 0.5;
            pointer-events: none;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .send-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* 工具栏 */
        .tool-bar {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 12px;
        }

        .tool-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            width: auto;
            height: auto;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: white;
            cursor: pointer;
            text-decoration: none;
            color: var(--text-primary);
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .tool-btn:hover {
            transform: scale(1.1);
            background-color: var(--theme-light);
            box-shadow: 0 4px 12px rgba(var(--theme-primary-rgb), 0.15);
        }

        .tool-btn:active {
            transform: scale(0.95);
        }

        .tool-btn .icon {
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .tool-btn:hover .icon {
            transform: translateY(-2px);
        }

        @media screen and (max-width: 768px) {
            .tool-btn {
                width: 40px;
                height: 40px;
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(5px);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .tool-btn:hover {
                transform: scale(1.1);
                background: rgba(255, 255, 255, 0.95);
            }
        }

        .tool-btn[title="新对话"]:hover {
            background-color: var(--theme-light);
        }

        .tool-btn[title="导出对话"]:hover {
            background-color: var(--theme-light);
        }

        .tool-btn[href="tel:15516627307"]:hover {
            background-color: rgba(255, 182, 193, 0.2);
        }

        .tool-btn[href="photos.html"]:hover {
            background-color: var(--theme-light);
        }

        .tool-btn[title="历史对话"]:hover {
            background-color: var(--theme-light);
        }

        .tool-btn[title="发送到邮箱"]:hover {
            background-color: var(--theme-light);
        }

        .tool-btn {
            position: relative;
            overflow: hidden;
        }

        .tool-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(var(--theme-primary-rgb), 0.2) 0%, transparent 60%);
            transform: translate(-50%, -50%) scale(1);
            transition: transform 0.3s ease;
            border-radius: 8px;
            pointer-events: none;
        }

        .tool-btn:hover::after {
            transform: translate(-50%, -50%) scale(1.1);
        }

        /* 消息样式 */
        .message {
            margin: 10px 0;
            max-width: 80%;
        }

        .message.ai {
            margin-right: auto;
        }

        .message.user {
            margin-left: auto;
        }

        .message-content {
            padding: 10px 15px;
            border-radius: 15px;
            background: var(--theme-light);
        }

        .message.user .message-content {
            background: var(--theme-primary);
            color: white;
        }

        /* 添加背景花纹 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                    radial-gradient(circle at 10% 20%, var(--theme-light) 0%, transparent 20%),
                    radial-gradient(circle at 90% 80%, var(--theme-light) 0%, transparent 20%),
                    radial-gradient(circle at 50% 50%, var(--theme-light) 0%, transparent 25%);
            opacity: 0.6;
            z-index: -1;
        }

        /* 添加装饰元素 */
        .decoration {
            position: fixed;
            pointer-events: none;
        }

        .decoration-top-left {
            top: 0;
            left: 0;
            width: 200px;
            height: 200px;
            background:
                    radial-gradient(circle at 30% 30%, var(--theme-light) 0%, transparent 70%);
        }

        .decoration-bottom-right {
            bottom: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background:
                    radial-gradient(circle at 70% 70%, var(--theme-light) 0%, transparent 70%);
        }

        /* 添加专业模式的主题样式 */
        .container[data-mode="professional"] {
            --theme-primary: var(--blue-primary);
            --theme-light: var(--blue-light);
            --theme-border: var(--blue-border);
        }

        /* 添加浮动背景元素的样式 */
        .floating-items {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-item {
            position: absolute;
            opacity: 0.6;
            animation: float 20s linear infinite;
        }

        /* 可爱模式的背景元素 */
        .floating-item.cute {
            font-size: 24px;
        }

        /* 专业模式的背景元素 */
        .floating-item.professional {
            font-size: 20px;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
            }
        }

        /* 在 style 标签中添加新样式 */
        .chat-history-panel {
            position: fixed;
            right: -300px;
            top: 0;
            width: 300px;
            height: 100%;
            background-color: #fff;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
        }

        .chat-history-panel.open {
            right: 0;
        }

        .history-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-list {
            padding: 15px;
            overflow-y: auto;
            height: calc(100% - 60px);
        }

        .history-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid var(--border-color);
        }

        .history-item:hover {
            background-color: var(--theme-light);
        }

        .history-item .title {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .history-item .timestamp {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .close-history {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        /* 在 style 标签中添加邮件发送按钮的悬停效果 */
        .tool-btn[title="发送到邮箱"]:hover {
            background-color: var(--theme-light);
            transform: scale(1.1);
        }

        /* 移动端适配 */
        @media screen and (max-width: 768px) {
            /* 主容器样式 */
            .container {
                max-width: 100%;
                margin: 0;
                padding: 15px;
                border-radius: 0;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            /* 聊天区域 */
            .chat-container {
                flex: 1;
                height: auto;
                margin-bottom: 10px;
            }

            /* 输入区域 */
            .input-area {
                position: sticky;
                bottom: 0;
                background: rgba(255, 255, 255, 0.95);
                padding: 10px 0;
                margin: 0 -15px;
                padding: 10px 15px;
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            }

            .input-field {
                border-radius: 20px;
                padding: 12px 15px;
                font-size: 16px;
                line-height: 1.4;
            }

            /* 快捷操作区 */
            .quick-actions {
                padding: 5px 0;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin: 10px -15px;
                padding: 0 15px;
            }

            .quick-btn {
                padding: 8px 15px;
                font-size: 14px;
                white-space: nowrap;
                border-radius: 15px;
                background: var(--theme-light);
                border: 1px solid var(--theme-border);
            }

            /* 工具栏 */
            .tool-bar {
                position: fixed;
                bottom: 90px;
                right: 10px;
                top: auto;
                display: flex;
                flex-direction: column;
                gap: 8px;
                z-index: 100;
            }

            .tool-btn {
                width: 35px;
                height: 35px;
                padding: 6px;
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(5px);
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
                border-radius: 8px;
            }

            /* 隐藏文字标签，只显示图标 */
            .tool-btn .label {
                display: none;
            }

            .tool-btn .icon {
                font-size: 18px;
                margin: 0;
            }

            /* 主容器适配 */
            .container {
                padding: 15px 15px 80px 15px;
            }

            /* 聊天区域适配 */
            .chat-container {
                height: calc(100vh - 200px);
                margin-bottom: 10px;
            }

            /* 输入区域固定在底部 */
            .input-area {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(5px);
                padding: 10px 15px;
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
                z-index: 99;
            }

            /* 适配iPhone底部安全区域 */
            @supports (padding-bottom: env(safe-area-inset-bottom)) {
                .input-area {
                    padding-bottom: calc(10px + env(safe-area-inset-bottom));
                }
            }
        }

        /* 添加加载状态样式 */
        .message.ai.loading {
            background-color: #f0f0f0;
            color: #999;
        }

        .message.ai.loading .message-content {
            text-align: center;
        }

        /* 添加加载状态样式 */
        .message.loading .message-content {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .message.loading .message-content::after {
            content: '';
            width: 12px;
            height: 12px;
            border: 2px solid var(--theme-primary);
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* 优化发送按钮禁用状态 */
        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* 发送钮样式 */
        .send-btn {
            padding: 0 20px;
            border: none;
            border-radius: 20px;
            background: var(--theme-primary);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            height: 40px;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            opacity: 0.5; /* 默认状态透明度降低 */
            pointer-events: none; /* 默认不可点击 */
        }

        /* 当输入框有内容时的发送按钮样 */
        .send-btn.active {
            opacity: 1;
            pointer-events: auto;
            background: var(--theme-primary);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(var(--theme-primary-rgb), 0.3);
        }

        .send-btn.active:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(var(--theme-primary-rgb), 0.4);
        }

        .send-btn.active:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(var(--theme-primary-rgb), 0.3);
        }

        /* 历史记录项样式 */
        .history-item {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .history-item:hover {
            background: var(--theme-light);
        }

        .history-content {
            flex: 1;
            min-width: 0;
        }

        .history-title {
            display: block;
            font-weight: 500;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* 删除按钮样式 */
        .delete-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: none;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .delete-btn:hover {
            opacity: 1;
            background: rgba(var(--theme-primary-rgb), 0.1);
        }

        .trash-icon {
            font-size: 16px;
        }

        /* 确认对话框样式 */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1100;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .confirm-dialog.show {
            opacity: 1;
        }

        .confirm-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .confirm-dialog.show .confirm-content {
            transform: scale(1);
        }

        .confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
        }

        .confirm-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .confirm-btn.cancel {
            background: #f5f5f5;
            color: var(--text-primary);
        }

        .confirm-btn.delete {
            background: #ff4d4f;
            color: white;
        }

        .confirm-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* 删除动画 */
        .history-item.deleting {
            height: 0 !important;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            margin-bottom: 0;
            border-width: 0;
        }

        /* 背景图案样式 */
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: #fff;
            position: relative;
        }

        /* 可爱模式背景 */
        .container[data-mode="cute"] {
            background-color: #fff;
            background-image:
                /* 樱花花瓣图案 */
                    radial-gradient(6px 6px at 50px 50px, var(--pink-primary) 50%, transparent 50%),
                    radial-gradient(6px 6px at 100px 150px, var(--pink-primary) 50%, transparent 50%),
                    radial-gradient(8px 8px at 200px 100px, var(--pink-primary) 50%, transparent 50%),
                        /* 爱心点缀 */
                    radial-gradient(4px 4px at 150px 300px, #ff9999 50%, transparent 50%),
                        /* 星星装饰 */
                    radial-gradient(3px 3px at 300px 250px, #ffcc99 50%, transparent 50%),
                        /* 柔和的波点 */
                    radial-gradient(20px 20px at 250px 200px, rgba(255, 182, 193, 0.2) 50%, transparent 50%),
                    radial-gradient(15px 15px at 350px 150px, rgba(255, 192, 203, 0.15) 50%, transparent 50%);
            background-size: 400px 400px;
            background-repeat: repeat;
            opacity: 0.8;
        }

        /* 专业模式背景 */
        .container[data-mode="professional"] {
            background-color: #fff;
            background-image:
                /* 几何线条 */
                    linear-gradient(45deg, var(--blue-border) 1px, transparent 1px),
                    linear-gradient(-45deg, var(--blue-border) 1px, transparent 1px),
                        /* 点阵图案 */
                    radial-gradient(2px 2px at 50px 50px, var(--blue-primary) 50%, transparent 50%),
                    radial-gradient(2px 2px at 150px 150px, var(--blue-primary) 50%, transparent 50%),
                        /* 渐变装饰 */
                    linear-gradient(90deg, rgba(74, 144, 226, 0.05) 1px, transparent 1px),
                    linear-gradient(0deg, rgba(74, 144, 226, 0.05) 1px, transparent 1px);
            background-size:
                    100px 100px,
                    100px 100px,
                    200px 200px,
                    200px 200px,
                    20px 20px,
                    20px 20px;
            background-repeat: repeat;
            opacity: 0.9;
        }

        /* 添加背景过渡效果 */
        .container {
            transition: background-image 0.5s ease;
        }

        /* 移动端适配 */
        @media screen and (max-width: 768px) {
            .container[data-mode="cute"],
            .container[data-mode="professional"] {
                background-size:
                        200px 200px,
                        200px 200px,
                        100px 100px,
                        100px 100px,
                        10px 10px,
                        10px 10px;
            }
        }

        /* 针对特小屏幕的额外优化 */
        @media screen and (max-width: 320px) {
            .container {
                padding: 10px;
            }

            .tool-btn {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }

            .message-content {
                padding: 10px;
                font-size: 14px;
            }

            .input-field {
                padding: 10px 12px;
                font-size: 14px;
            }

            .logo h1 {
                font-size: 18px;
            }

            .subtitle {
                font-size: 12px;
            }

            .mode-btn {
                padding: 6px 12px;
                font-size: 13px;
            }
        }

        /* 针对不同屏幕高度的优化 */
        @media screen and (max-height: 600px) {
            .chat-container {
                height: calc(100vh - 200px);
            }

            .top-header {
                margin-bottom: 10px;
            }

            .tool-bar {
                position: fixed;
                bottom: 80px;
                right: 15px;
                top: auto;
                flex-direction: column;
                gap: 10px;
            }

            .tool-btn {
                width: 40px;
                height: 40px;
                font-size: 18px;
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(5px);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .chat-history-panel {
                width: 100%;
                right: -100%;
            }

            .chat-history-panel.open {
                right: 0;
            }

            .mode-switch {
                margin: 10px 0;
            }

            .mode-btn {
                padding: 8px 15px;
                font-size: 14px;
            }

            .message {
                max-width: 85%;
                margin: 8px 0;
            }

            .message-content {
                padding: 12px;
                font-size: 15px;
                line-height: 1.4;
                border-radius: 18px;
            }

            .top-header {
                margin-bottom: 15px;
            }

            .logo h1 {
                font-size: 20px;
            }

            .subtitle {
                font-size: 14px;
            }

            @supports (padding-top: env(safe-area-inset-top)) {
                .container {
                    padding-top: env(safe-area-inset-top);
                    padding-bottom: env(safe-area-inset-bottom);
                }
            }
        }

        /* 加载提示样式 */
        .loading-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #fff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-message {
            font-size: 14px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* 邮件发送按钮悬停效果 */
        .tool-btn[title="发送到邮箱"]:hover {
            background-color: var(--theme-light);
            transform: scale(1.1);
        }
    </style>
</head>
<body>
<div class="decoration decoration-top-left"></div>
<div class="decoration decoration-bottom-right"></div>

<div class="floating-items">
    <!-- 这些元素会通过 JavaScript 动态生成 -->
</div>


<div class="container">
    <!-- 顶部标题区域 -->
    <div class="top-header">
        <div class="logo">
            <img src="img.png" alt="心语" class="logo-img">
            <h1>心语</h1>
        </div>
        <div class="subtitle">
            由小chi为您服务 👋
        </div>
    </div>

    <!-- 主要内容区域 -->
    <div class="main-content">
        <!-- AI手信息 -->
        <div class="ai-profile">
            <!-- 模式切换 -->
            <div class="mode-switch">
                <button class="mode-btn active" data-mode="cute">可爱小chi</button>
                <button class="mode-btn" data-mode="professional">chi哥</button>
            </div>
        </div>

        <!-- 聊天记录标题 -->
        <h3 class="chat-title">聊天记录</h3>

        <!-- 聊天区域 -->
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <!-- 消息内容会动态插入 -->
            </div>
        </div>

        <!--        &lt;!&ndash; 快捷操作区 &ndash;&gt;-->
        <!--        <div class="quick-actions">-->
        <!--            <button class="quick-btn">👋 打个招呼</button>-->
        <!--            <button class="quick-btn">💡 寻求帮助</button>-->
        <!--            <button class="quick-btn">🎯 设定目标</button>-->
        <!--            <button class="quick-btn">📝 记录心情</button>-->
        <!--        </div>-->

        <!-- 输入区域 -->
        <div class="input-area">
                <textarea
                        class="input-field"
                        placeholder="输入消息... (Enter发送, Shift+Enter换行)"
                ></textarea>
            <button class="send-btn">发送</button>
        </div>
    </div>

    <!-- 右上角工具栏 -->
    <div class="tool-bar">
        <button class="tool-btn" title="新对话">
            <span class="icon">📝</span>
            <span class="label">新对话</span>
        </button>
        <button class="tool-btn" title="导出对话">
            <span class="icon">💾</span>
            <span class="label">导出</span>
        </button>
        <a href="tel:15516627307" class="tool-btn">
            <span class="icon">❤️</span>
            <span class="label">联系</span>
        </a>
        <a href="photos.html" class="tool-btn">
            <span class="icon">🏞️</span>
            <span class="label">相册</span>
        </a>
        <button class="tool-btn" title="历史对话">
            <span class="icon">💬</span>
            <span class="label">历史</span>
        </button>
        <button class="tool-btn" title="发送到邮箱">
            <span class="icon">📧</span>
            <span class="label">邮箱</span>
        </button>
    </div>
</div>


<!-- 添加背景装饰 -->
<div class="bg-decoration"></div>

<div class="mode-switch">
    <button class="mode-btn active" data-mode="cute">可爱小chi</button>
    <button class="mode-btn" data-mode="professional">chi哥</button>
</div>

<!-- 添加对话列表面板 -->
<div class="chat-history-panel">
    <div class="history-header">
        <h3>对话历史</h3>
        <button class="close-history">×</button>
    </div>
    <div class="history-list">
        <!-- 对话历史列表将在这里动态生成 -->
    </div>
</div>

<script>
    // 首先声明全局状态
    let globalState = {
        currentMode: 'cute',
        currentConversationId: null,
        conversations: [],
        chatService: null // 先设为 null，后续初始化
    };

    // 添加发送消息函数
    async function sendMessage(elements) {
        const messageText = elements.messageInput.value.trim();
        if (!messageText) return;

        // 禁用发送按钮防止重发送
        elements.sendButton.disabled = true;
        elements.sendButton.classList.remove('active');

        try {
            // 如果没有当前对话，创建新对话
            if (!globalState.currentConversationId) {
                createNewConversation(elements);
            }

            // 添加用户消息
            addMessage(elements, messageText, 'user');
            elements.messageInput.value = ''; // 清空输入框

            // 显示加载状态
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai loading';
            loadingDiv.innerHTML = `
                    <div class="message-content">
                        ${globalState.currentMode === 'cute' ? '思考中~💭' : '正在处理...'}
                    </div>
                `;
            elements.chatMessages.appendChild(loadingDiv);
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;

            // 获取AI回复
            const aiResponse = await globalState.chatService.getAIResponse(messageText, globalState.currentMode);

            // 移除加载状态
            loadingDiv.remove();

            // 添加AI回复
            addMessage(elements, aiResponse, 'ai');

        } catch (error) {
            console.error('获取AI回复时出错:', error);
            addMessage(elements, '抱歉噢乖，我遇到了一些问题，请稍后再试。', 'ai');
        } finally {
            // 重新启用发送按钮
            elements.sendButton.disabled = false;
        }
    }

    // 添加消息函数
    function addMessage(elements, content, type) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}`;
        messageDiv.innerHTML = `
                <div class="message-content">
                    ${content}
                </div>
            `;
        elements.chatMessages.appendChild(messageDiv);

        // 滚动到底部
        elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;

        // 保存到历史记录
        if (globalState.currentConversationId) {
            const conversations = loadConversations();
            const conversation = conversations.find(c => c.id === globalState.currentConversationId);
            if (conversation) {
                conversation.messages.push({
                    type,
                    content,
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('chatConversations', JSON.stringify(conversations));
            }
        }
    }

    // 添加创建新对话函数
    function createNewConversation(elements) {
        const conversation = {
            id: Date.now(),
            title: `对话 ${new Date().toLocaleString('zh-CN', {
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            })}`,
            messages: [],
            timestamp: new Date().toISOString()
        };

        const conversations = loadConversations();
        conversations.unshift(conversation);
        localStorage.setItem('chatConversations', JSON.stringify(conversations));

        globalState.currentConversationId = conversation.id;
        elements.chatMessages.innerHTML = '';

        updateHistoryList(elements);
    }

    // 加加载对话历史函数
    function loadConversations() {
        try {
            const saved = localStorage.getItem('chatConversations');
            return saved ? JSON.parse(saved) : [];
        } catch (error) {
            console.error('加载对话历史失败:', error);
            return [];
        }
    }

    // 添加更新历史列表函数
    function updateHistoryList(elements) {
        const conversations = loadConversations();
        elements.historyList.innerHTML = '';

        conversations.forEach(conv => {
            const item = document.createElement('div');
            item.className = 'history-item';
            item.innerHTML = `
                    <div class="history-content">
                        <span class="history-title">${conv.title}</span>
                        <span class="history-time">${new Date(conv.timestamp).toLocaleString('zh-CN')}</span>
                    </div>
                    <button class="delete-btn" title="删除对话">
                        <span class="trash-icon">🗑️</span>
                    </button>
                `;

            // 为删除按钮添加点击事件
            const deleteBtn = item.querySelector('.delete-btn');
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // 阻止事件冒泡

                // 显示确认对话框
                const confirmDialog = document.createElement('div');
                confirmDialog.className = 'confirm-dialog';
                confirmDialog.innerHTML = `
                        <div class="confirm-content">
                            <p>确定要删除这条对话吗？</p>
                            <div class="confirm-buttons">
                                <button class="confirm-btn cancel">取消</button>
                                <button class="confirm-btn delete">删除</button>
                            </div>
                        </div>
                    `;

                document.body.appendChild(confirmDialog);

                // 添加动画类
                setTimeout(() => confirmDialog.classList.add('show'), 10);

                // 绑定确认框按钮事件
                confirmDialog.querySelector('.cancel').addEventListener('click', () => {
                    confirmDialog.classList.remove('show');
                    setTimeout(() => confirmDialog.remove(), 300);
                });

                confirmDialog.querySelector('.delete').addEventListener('click', () => {
                    // 删除对话
                    const conversations = loadConversations();
                    const index = Array.from(elements.historyList.children).indexOf(item);
                    conversations.splice(index, 1);
                    localStorage.setItem('chatConversations', JSON.stringify(conversations));

                    // 动画效果
                    item.style.height = item.offsetHeight + 'px';
                    item.offsetHeight; // 触发重排
                    item.classList.add('deleting');

                    setTimeout(() => {
                        item.remove();
                        // 如果删除的是当前对话，清空聊天区域
                        if (conversations[index]?.id === globalState.currentConversationId) {
                            elements.chatMessages.innerHTML = '';
                            globalState.currentConversationId = null;
                        }
                    }, 300);

                    confirmDialog.classList.remove('show');
                    setTimeout(() => confirmDialog.remove(), 300);
                });
            });

            elements.historyList.appendChild(item);
        });
    }

    // 所有函数定义
    function switchMode(mode, elements) {
        globalState.currentMode = mode;

        // 更新按钮状态
        elements.modeBtns.forEach(btn => {
            btn.classList.toggle('active', btn.getAttribute('data-mode') === mode);
        });

        // 更新容器数据属性
        elements.container.setAttribute('data-mode', mode);

        // 更新主题颜色
        if (mode === 'cute') {
            document.documentElement.style.setProperty('--theme-primary', 'var(--pink-primary)');
            document.documentElement.style.setProperty('--theme-light', 'var(--pink-light)');
            document.documentElement.style.setProperty('--theme-border', 'var(--pink-border)');
            document.documentElement.style.setProperty('--theme-primary-rgb', '255, 158, 201');
        } else {
            document.documentElement.style.setProperty('--theme-primary', 'var(--blue-primary)');
            document.documentElement.style.setProperty('--theme-light', 'var(--blue-light)');
            document.documentElement.style.setProperty('--theme-border', 'var(--blue-border)');
            document.documentElement.style.setProperty('--theme-primary-rgb', '74, 144, 226');
        }

        // 更新背景效果
        if (window.backgroundEffect) {
            window.backgroundEffect.updateBackground(mode);
        }
    }

    function initializeApp() {
        // 初始化 ChatService
        globalState.chatService = new ChatService();

        // 获取所有需要的 DOM 元素
        const elements = {
            historyBtn: document.querySelector('.tool-btn[title="历史对话"]'),
            newChatBtn: document.querySelector('.tool-btn[title="新对话"]'),
            exportBtn: document.querySelector('.tool-btn[title="导出对话"]'),
            historyPanel: document.querySelector('.chat-history-panel'),
            closeHistoryBtn: document.querySelector('.close-history'),
            historyList: document.querySelector('.history-list'),
            chatMessages: document.getElementById('chatMessages'),
            container: document.querySelector('.container'),
            modeBtns: document.querySelectorAll('.mode-btn'),
            messageInput: document.querySelector('.input-field'),
            sendButton: document.querySelector('.send-btn'),
            quickBtns: document.querySelectorAll('.quick-btn')
        };

        // 初始化背景效果
        window.backgroundEffect = new BackgroundEffect();
        window.backgroundEffect.updateBackground(globalState.currentMode);

        // 绑定事件监听器
        bindEventListeners(elements);

        // 初始化发送按钮状态
        updateSendButtonState(elements.messageInput, elements.sendButton);
    }

    function bindEventListeners(elements) {
        // 模式切换按钮事件
        elements.modeBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const mode = this.getAttribute('data-mode');
                switchMode(mode, elements);
            });
        });

        // 输入框事件
        elements.messageInput.addEventListener('input', function() {
            updateSendButtonState(this, elements.sendButton);
        });

        // 发送按钮事件
        elements.sendButton.addEventListener('click', () => {
            if (elements.messageInput.value.trim()) {
                sendMessage(elements);
            }
        });

        // 工具栏按钮事件
        // 新对话按钮
        elements.newChatBtn.addEventListener('click', () => {
            createNewConversation(elements);
            elements.chatMessages.innerHTML = '';
            elements.messageInput.value = '';
            updateSendButtonState(elements.messageInput, elements.sendButton);
        });

        // 历史对话按钮
        elements.historyBtn.addEventListener('click', () => {
            elements.historyPanel.classList.add('open');
            updateHistoryList(elements);
        });

        // 关闭历史面板按钮
        elements.closeHistoryBtn.addEventListener('click', () => {
            elements.historyPanel.classList.remove('open');
        });

        // 导出对话按钮
        elements.exportBtn.addEventListener('click', () => {
            exportConversation(elements);
        });

        // 历史记录项点击事件
        elements.historyList.addEventListener('click', (e) => {
            const historyItem = e.target.closest('.history-item');
            if (historyItem) {
                const conversations = loadConversations();
                const index = Array.from(elements.historyList.children).indexOf(historyItem);
                if (conversations[index]) {
                    loadConversation(conversations[index], elements);
                    elements.historyPanel.classList.remove('open');
                }
            }
        });

        // 添加邮件发送按钮事件
        const emailBtn = document.querySelector('.tool-btn[title="发送到邮箱"]');
        emailBtn.addEventListener('click', () => {
            // 获取当前对话内容
            const messages = document.querySelectorAll('.message');
            if (messages.length === 0) {
                alert('暂无对话内容可导出');
                return;
            }

            // 格式化对话内容
            let content = `心语AI对话记录\n`;
            content += `时间：${new Date().toLocaleString('zh-CN')}\n\n`;

            messages.forEach(msg => {
                const isAI = msg.classList.contains('ai');
                const text = msg.querySelector('.message-content').textContent;
                content += `${isAI ? 'AI' : '我'}：${text}\n`;
            });

            // 发送邮件
            sendToEmail(content);
        });
    }

    function updateSendButtonState(input, button) {
        if (input.value.trim()) {
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    }

    // 在 DOMContentLoaded 事件中初始化应用
    document.addEventListener('DOMContentLoaded', () => {
        initializeApp();
    });

    class ChatService {
        constructor() {
            this.apiUrl = 'https://api.openai-hk.com/v1/chat/completions';
            // API密钥应该从环境变量或后端获取，这里仅作示例
            this.apiKey = 'hk-c5kbbx1000025081b7586ac34f0da06c99975d1780d819f8';
        }

        async getAIResponse(message, mode) {
            try {
                const response = await fetch(this.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiKey}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [
                            {
                                role: "system",
                                content: this.getSystemPrompt(mode)
                            },
                            {
                                role: "user",
                                content: message
                            }
                        ],
                        temperature: mode === 'cute' ? 0.85 : 0.7,
                        max_tokens: 1000
                    })
                });

                if (!response.ok) {
                    throw new Error(`API错误: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;

            } catch (error) {
                console.error('API调用错误:', error);
                throw error;
            }
        }

        getSystemPrompt(mode) {
            return mode === 'cute'
                ? `你是一个名小chi的AI助手，正在为一位名叫心语的用服务。
                       性格特：
                       1. 说话活泼可爱，经常使用可爱的语气词
                       2. 适度使用emoji表情
                       3. 回答亲切温暖，像小助手样
                       4. 称呼用户为"心语"

                       回复要求：
                       1. 回复要简短精炼，通常不超过100字
                       2. 每次回复最多使用2-3个emoji
                       3. 保持可爱但不失专业性`
                : `是一个名叫chi哥的AI助手，正在为一位名叫心语的用服务。
                       性格特点：
                       1. 说话稳重专业，用词准确
                       2. 态度温和但不失专业
                       3. 回答问题时条理清晰

                       复要求：
                       1. 回复要完整专业，但不过于冗长
                       2. 适当使用专业术语，但要确保用户能理解
                       3. 在专业建议融入温和的关怀`;
        }
    }

    class BackgroundEffect {
        constructor() {
            this.container = document.querySelector('.floating-items');
            this.cuteElements = ['🌸', '💗', '✨', '🎀', '🌟', '💝', '🦄', '🍭'];
            this.professionalElements = ['💫', '⭐', '✧', '🌧️', '💠', '🔷', '📱', '💡'];
            this.items = [];
        }

        createItem(mode) {
            const item = document.createElement('div');
            item.className = `floating-item ${mode}`;
            item.style.left = `${Math.random() * 100}vw`;
            item.style.animationDuration = `${15 + Math.random() * 15}s`;
            item.style.opacity = `${0.1 + Math.random() * 0.3}`;

            const elements = mode === 'cute' ? this.cuteElements : this.professionalElements;
            item.textContent = elements[Math.floor(Math.random() * elements.length)];

            return item;
        }

        updateBackground(mode) {
            // 清除现有元素
            this.container.innerHTML = '';

            // 创建新的背景元素
            for (let i = 0; i < 20; i++) {
                const item = this.createItem(mode);
                this.container.appendChild(item);
            }
        }
    }

    // 添加导出对话功能
    function exportConversation(elements) {
        const conversations = loadConversations();
        if (conversations.length === 0) {
            alert('暂无对话可导出');
            return;
        }

        const currentConversation = conversations.find(c => c.id === globalState.currentConversationId) || conversations[0];
        let textContent = `对话记录 - ${currentConversation.title}\n`;
        textContent += `时间：${new Date(currentConversation.timestamp).toLocaleString('zh-CN')}\n\n`;

        currentConversation.messages.forEach(msg => {
            const speaker = msg.type === 'user' ? '我' : 'AI';
            textContent += `${speaker}：${msg.content}\n`;
        });

        // 创建并下载文本文件
        const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `对话记录_${new Date().toLocaleDateString()}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        // 询问是否发送到邮箱
        if (confirm('是否将对话记录发送到邮箱？')) {
            sendToEmail(textContent);
        }
    }

    // 添加加载对话功能
    function loadConversation(conversation, elements) {
        globalState.currentConversationId = conversation.id;
        elements.chatMessages.innerHTML = '';

        conversation.messages.forEach(msg => {
            addMessage(elements, msg.content, msg.type);
        });
    }

    // 添加邮件发送功能
    function sendToEmail(content) {
        try {
            // 格式化邮件内容
            const subject = encodeURIComponent(`心语AI对话记录 - ${new Date().toLocaleDateString()}`);
            const body = encodeURIComponent(content);

            // 创建mailto链接
            const mailtoLink = `mailto:?subject=${subject}&body=${body}`;

            // 创建并触发链接
            const link = document.createElement('a');
            link.href = mailtoLink;
            link.click();

        } catch (error) {
            console.error('发送邮件时出错:', error);
            alert('发送邮件失败，请稍后重试');
        }
    }
</script>
</body>
</html> 