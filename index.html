<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒè¯­ AI</title>
    <style>
        :root {
            --pink-primary: #FF9EC9;
            --pink-primary-rgb: 255, 158, 201;
            --pink-light: #FFF5F9;
            --pink-border: rgba(255, 158, 201, 0.3);

            --blue-primary: #4A90E2;
            --blue-primary-rgb: 74, 144, 226;
            --blue-light: #F5F9FF;
            --blue-border: rgba(74, 144, 226, 0.3);

            --theme-primary: var(--pink-primary);
            --theme-light: var(--pink-light);
            --theme-border: var(--pink-border);
            --theme-primary-rgb: var(--pink-primary-rgb);

            --text-primary: #333;
            --text-secondary: #666;
            --border-color: #eee;
        }

        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: #fff;
            position: relative;
            overflow-x: hidden;
        }

        /* æ·»åŠ èƒŒæ™¯èŠ±çº¹ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                    radial-gradient(circle at 10% 20%, var(--theme-light) 0%, transparent 20%),
                    radial-gradient(circle at 90% 80%, var(--theme-light) 0%, transparent 20%),
                    radial-gradient(circle at 50% 50%, var(--theme-light) 0%, transparent 25%);
            opacity: 0.6;
            z-index: -1;
        }

        /* è£…é¥°å…ƒç´ æ ·å¼ */
        .decoration {
            position: fixed;
            pointer-events: none;
            z-index: -1;
        }

        .decoration-top-left {
            top: 0;
            left: 0;
            width: 200px;
            height: 200px;
            background:
                    radial-gradient(circle at 30% 30%, var(--theme-light) 0%, transparent 70%);
        }

        .decoration-bottom-right {
            bottom: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background:
                    radial-gradient(circle at 70% 70%, var(--theme-light) 0%, transparent 70%);
        }

        /* æµ®åŠ¨å…ƒç´ å®¹å™¨æ ·å¼ */
        .floating-items {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .floating-item {
            position: absolute;
            opacity: 0.6;
            animation: float 20s linear infinite;
            will-change: transform;
        }

        /* å¯çˆ±æ¨¡å¼çš„èƒŒæ™¯å…ƒç´  */
        .floating-item.cute {
            font-size: 24px;
        }

        /* ä¸“ä¸šæ¨¡å¼çš„èƒŒæ™¯å…ƒç´  */
        .floating-item.professional {
            font-size: 20px;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-50px) rotate(360deg);
                opacity: 0;
            }
        }

        /* ä¸»å®¹å™¨æ ·å¼æ›´æ–° */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
            z-index: 1;
        }

        /* é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ */
        .top-header {
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-img {
            height: 32px;
        }

        .logo h1 {
            font-size: 24px;
            margin: 0;
        }

        .subtitle {
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* AIåŠ©æ‰‹ä¿¡æ¯ */
        .ai-profile {
            text-align: center;
            margin-bottom: 30px;
        }

        .ai-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 10px;
        }

        .ai-profile h2 {
            margin: 0;
            font-size: 20px;
        }

        .ai-profile p {
            color: var(--text-secondary);
            margin: 5px 0;
        }

        /* æ¨¡å¼åˆ‡æ¢ */
        .mode-switch {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }

        .mode-btn {
            padding: 6px 12px;
            border-radius: 15px;
            border: 1px solid var(--theme-primary);
            background: white;
            cursor: pointer;
        }

        .mode-btn.active {
            background: var(--theme-primary);
            color: white;
        }

        /* èŠå¤©åŒºåŸŸ */
        .chat-title {
            font-size: 16px;
            margin-bottom: 15px;
        }

        .chat-container {
            height: 400px;
            overflow-y: auto;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 12px rgba(var(--theme-primary-rgb), 0.1);
            border: 2px solid var(--theme-border);
            position: relative;
        }

        /* æ·»åŠ å†…éƒ¨è£…é¥°è¾¹æ¡† */
        .chat-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border-radius: 16px;
            background: linear-gradient(
                    135deg,
                    rgba(var(--theme-primary-rgb), 0.3) 0%,
                    rgba(var(--theme-primary-rgb), 0.1) 50%,
                    rgba(var(--theme-primary-rgb), 0.3) 100%
            );
            z-index: -1;
            pointer-events: none;
        }

        /* å¯çˆ±æ¨¡å¼ç‰¹æ®Šè£…é¥° */
        .container[data-mode="cute"] .chat-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(
                    90deg,
                    transparent 0%,
                    var(--theme-primary) 50%,
                    transparent 100%
            );
            opacity: 0.5;
            border-radius: 16px 16px 0 0;
        }

        /* ä¸“ä¸šæ¨¡å¼ç‰¹æ®Šè£…é¥° */
        .container[data-mode="professional"] .chat-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(
                    180deg,
                    transparent 0%,
                    var(--theme-primary) 50%,
                    transparent 100%
            );
            opacity: 0.5;
            border-radius: 16px 0 0 16px;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        .chat-container::-webkit-scrollbar {
            width: 6px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: var(--theme-light);
            border-radius: 3px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: var(--theme-primary);
            border-radius: 3px;
            opacity: 0.6;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media screen and (max-width: 768px) {
            .chat-container {
                border-radius: 12px;
                padding: 15px;
                margin-bottom: 15px;
            }

            .chat-container::before {
                border-radius: 12px;
            }
        }

        /* å¿«æ·æ“ä½œåŒº */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background: white;
            cursor: pointer;
            white-space: nowrap;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-area {
            display: flex;
            gap: 10px;
        }

        .input-field {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            resize: none;
            height: 40px;
            font-size: 14px;
        }

        .send-btn {
            padding: 0 20px;
            border: none;
            border-radius: 20px;
            background: var(--theme-primary);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            height: 40px;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            opacity: 0.5;
            pointer-events: none;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .send-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* å·¥å…·æ  */
        .tool-bar {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 12px;
        }

        .tool-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            width: auto;
            height: auto;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: white;
            cursor: pointer;
            text-decoration: none;
            color: var(--text-primary);
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .tool-btn:hover {
            transform: scale(1.1);
            background-color: var(--theme-light);
            box-shadow: 0 4px 12px rgba(var(--theme-primary-rgb), 0.15);
        }

        .tool-btn:active {
            transform: scale(0.95);
        }

        .tool-btn .icon {
            font-size: 20px;
            transition: transform 0.3s ease;
        }

        .tool-btn:hover .icon {
            transform: translateY(-2px);
        }

        @media screen and (max-width: 768px) {
            .tool-btn {
                width: 40px;
                height: 40px;
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(5px);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .tool-btn:hover {
                transform: scale(1.1);
                background: rgba(255, 255, 255, 0.95);
            }
        }

        .tool-btn[title="æ–°å¯¹è¯"]:hover {
            background-color: var(--theme-light);
        }

        .tool-btn[title="å¯¼å‡ºå¯¹è¯"]:hover {
            background-color: var(--theme-light);
        }

        .tool-btn[href="tel:15516627307"]:hover {
            background-color: rgba(255, 182, 193, 0.2);
        }

        .tool-btn[href="photos.html"]:hover {
            background-color: var(--theme-light);
        }

        .tool-btn[title="å†å²å¯¹è¯"]:hover {
            background-color: var(--theme-light);
        }

        .tool-btn[title="å‘é€åˆ°é‚®ç®±"]:hover {
            background-color: var(--theme-light);
        }

        .tool-btn {
            position: relative;
            overflow: hidden;
        }

        .tool-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(var(--theme-primary-rgb), 0.2) 0%, transparent 60%);
            transform: translate(-50%, -50%) scale(1);
            transition: transform 0.3s ease;
            border-radius: 8px;
            pointer-events: none;
        }

        .tool-btn:hover::after {
            transform: translate(-50%, -50%) scale(1.1);
        }

        /* æ¶ˆæ¯æ ·å¼ */
        .message {
            margin: 10px 0;
            max-width: 80%;
        }

        .message.ai {
            margin-right: auto;
        }

        .message.user {
            margin-left: auto;
        }

        .message-content {
            padding: 10px 15px;
            border-radius: 15px;
            background: var(--theme-light);
        }

        .message.user .message-content {
            background: var(--theme-primary);
            color: white;
        }

        /* æ·»åŠ èƒŒæ™¯èŠ±çº¹ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                    radial-gradient(circle at 10% 20%, var(--theme-light) 0%, transparent 20%),
                    radial-gradient(circle at 90% 80%, var(--theme-light) 0%, transparent 20%),
                    radial-gradient(circle at 50% 50%, var(--theme-light) 0%, transparent 25%);
            opacity: 0.6;
            z-index: -1;
        }

        /* æ·»åŠ è£…é¥°å…ƒç´  */
        .decoration {
            position: fixed;
            pointer-events: none;
        }

        .decoration-top-left {
            top: 0;
            left: 0;
            width: 200px;
            height: 200px;
            background:
                    radial-gradient(circle at 30% 30%, var(--theme-light) 0%, transparent 70%);
        }

        .decoration-bottom-right {
            bottom: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background:
                    radial-gradient(circle at 70% 70%, var(--theme-light) 0%, transparent 70%);
        }

        /* æ·»åŠ ä¸“ä¸šæ¨¡å¼çš„ä¸»é¢˜æ ·å¼ */
        .container[data-mode="professional"] {
            --theme-primary: var(--blue-primary);
            --theme-light: var(--blue-light);
            --theme-border: var(--blue-border);
        }

        /* æ·»åŠ æµ®åŠ¨èƒŒæ™¯å…ƒç´ çš„æ ·å¼ */
        .floating-items {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-item {
            position: absolute;
            opacity: 0.6;
            animation: float 20s linear infinite;
        }

        /* å¯çˆ±æ¨¡å¼çš„èƒŒæ™¯å…ƒç´  */
        .floating-item.cute {
            font-size: 24px;
        }

        /* ä¸“ä¸šæ¨¡å¼çš„èƒŒæ™¯å…ƒç´  */
        .floating-item.professional {
            font-size: 20px;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
            }
        }

        /* åœ¨ style æ ‡ç­¾ä¸­æ·»åŠ æ–°æ ·å¼ */
        .chat-history-panel {
            position: fixed;
            right: -300px;
            top: 0;
            width: 300px;
            height: 100%;
            background-color: #fff;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
        }

        .chat-history-panel.open {
            right: 0;
        }

        .history-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-list {
            padding: 15px;
            overflow-y: auto;
            height: calc(100% - 60px);
        }

        .history-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            border: 1px solid var(--border-color);
        }

        .history-item:hover {
            background-color: var(--theme-light);
        }

        .history-item .title {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .history-item .timestamp {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .close-history {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        /* åœ¨ style æ ‡ç­¾ä¸­æ·»åŠ é‚®ä»¶å‘é€æŒ‰é’®çš„æ‚¬åœæ•ˆæœ */
        .tool-btn[title="å‘é€åˆ°é‚®ç®±"]:hover {
            background-color: var(--theme-light);
            transform: scale(1.1);
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media screen and (max-width: 768px) {
            /* ä¸»å®¹å™¨æ ·å¼ */
            .container {
                max-width: 100%;
                margin: 0;
                padding: 15px;
                border-radius: 0;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            /* èŠå¤©åŒºåŸŸ */
            .chat-container {
                flex: 1;
                height: auto;
                margin-bottom: 10px;
            }

            /* è¾“å…¥åŒºåŸŸ */
            .input-area {
                position: sticky;
                bottom: 0;
                background: rgba(255, 255, 255, 0.95);
                padding: 10px 0;
                margin: 0 -15px;
                padding: 10px 15px;
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            }

            .input-field {
                border-radius: 20px;
                padding: 12px 15px;
                font-size: 16px;
                line-height: 1.4;
            }

            /* å¿«æ·æ“ä½œåŒº */
            .quick-actions {
                padding: 5px 0;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin: 10px -15px;
                padding: 0 15px;
            }

            .quick-btn {
                padding: 8px 15px;
                font-size: 14px;
                white-space: nowrap;
                border-radius: 15px;
                background: var(--theme-light);
                border: 1px solid var(--theme-border);
            }

            /* å·¥å…·æ  */
            .tool-bar {
                position: fixed;
                bottom: 90px;
                right: 10px;
                top: auto;
                display: flex;
                flex-direction: column;
                gap: 8px;
                z-index: 100;
            }

            .tool-btn {
                width: 35px;
                height: 35px;
                padding: 6px;
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(5px);
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
                border-radius: 8px;
            }

            /* éšè—æ–‡å­—æ ‡ç­¾ï¼Œåªæ˜¾ç¤ºå›¾æ ‡ */
            .tool-btn .label {
                display: none;
            }

            .tool-btn .icon {
                font-size: 18px;
                margin: 0;
            }

            /* ä¸»å®¹å™¨é€‚é… */
            .container {
                padding: 15px 15px 80px 15px;
            }

            /* èŠå¤©åŒºåŸŸé€‚é… */
            .chat-container {
                height: calc(100vh - 200px);
                margin-bottom: 10px;
            }

            /* è¾“å…¥åŒºåŸŸå›ºå®šåœ¨åº•éƒ¨ */
            .input-area {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(5px);
                padding: 10px 15px;
                box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
                z-index: 99;
            }

            /* é€‚é…iPhoneåº•éƒ¨å®‰å…¨åŒºåŸŸ */
            @supports (padding-bottom: env(safe-area-inset-bottom)) {
                .input-area {
                    padding-bottom: calc(10px + env(safe-area-inset-bottom));
                }
            }
        }

        /* æ·»åŠ åŠ è½½çŠ¶æ€æ ·å¼ */
        .message.ai.loading {
            background-color: #f0f0f0;
            color: #999;
        }

        .message.ai.loading .message-content {
            text-align: center;
        }

        /* æ·»åŠ åŠ è½½çŠ¶æ€æ ·å¼ */
        .message.loading .message-content {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .message.loading .message-content::after {
            content: '';
            width: 12px;
            height: 12px;
            border: 2px solid var(--theme-primary);
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* ä¼˜åŒ–å‘é€æŒ‰é’®ç¦ç”¨çŠ¶æ€ */
        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* å‘é€é’®æ ·å¼ */
        .send-btn {
            padding: 0 20px;
            border: none;
            border-radius: 20px;
            background: var(--theme-primary);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            height: 40px;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            opacity: 0.5; /* é»˜è®¤çŠ¶æ€é€æ˜åº¦é™ä½ */
            pointer-events: none; /* é»˜è®¤ä¸å¯ç‚¹å‡» */
        }

        /* å½“è¾“å…¥æ¡†æœ‰å†…å®¹æ—¶çš„å‘é€æŒ‰é’®æ · */
        .send-btn.active {
            opacity: 1;
            pointer-events: auto;
            background: var(--theme-primary);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(var(--theme-primary-rgb), 0.3);
        }

        .send-btn.active:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(var(--theme-primary-rgb), 0.4);
        }

        .send-btn.active:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(var(--theme-primary-rgb), 0.3);
        }

        /* å†å²è®°å½•é¡¹æ ·å¼ */
        .history-item {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .history-item:hover {
            background: var(--theme-light);
        }

        .history-content {
            flex: 1;
            min-width: 0;
        }

        .history-title {
            display: block;
            font-weight: 500;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* åˆ é™¤æŒ‰é’®æ ·å¼ */
        .delete-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: none;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .delete-btn:hover {
            opacity: 1;
            background: rgba(var(--theme-primary-rgb), 0.1);
        }

        .trash-icon {
            font-size: 16px;
        }

        /* ç¡®è®¤å¯¹è¯æ¡†æ ·å¼ */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1100;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .confirm-dialog.show {
            opacity: 1;
        }

        .confirm-content {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-align: center;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .confirm-dialog.show .confirm-content {
            transform: scale(1);
        }

        .confirm-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
        }

        .confirm-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .confirm-btn.cancel {
            background: #f5f5f5;
            color: var(--text-primary);
        }

        .confirm-btn.delete {
            background: #ff4d4f;
            color: white;
        }

        .confirm-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* åˆ é™¤åŠ¨ç”» */
        .history-item.deleting {
            height: 0 !important;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            margin-bottom: 0;
            border-width: 0;
        }

        /* èƒŒæ™¯å›¾æ¡ˆæ ·å¼ */
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background: #fff;
            position: relative;
        }

        /* å¯çˆ±æ¨¡å¼èƒŒæ™¯ */
        .container[data-mode="cute"] {
            background-color: #fff;
            background-image:
                /* æ¨±èŠ±èŠ±ç“£å›¾æ¡ˆ */
                    radial-gradient(6px 6px at 50px 50px, var(--pink-primary) 50%, transparent 50%),
                    radial-gradient(6px 6px at 100px 150px, var(--pink-primary) 50%, transparent 50%),
                    radial-gradient(8px 8px at 200px 100px, var(--pink-primary) 50%, transparent 50%),
                        /* çˆ±å¿ƒç‚¹ç¼€ */
                    radial-gradient(4px 4px at 150px 300px, #ff9999 50%, transparent 50%),
                        /* æ˜Ÿæ˜Ÿè£…é¥° */
                    radial-gradient(3px 3px at 300px 250px, #ffcc99 50%, transparent 50%),
                        /* æŸ”å’Œçš„æ³¢ç‚¹ */
                    radial-gradient(20px 20px at 250px 200px, rgba(255, 182, 193, 0.2) 50%, transparent 50%),
                    radial-gradient(15px 15px at 350px 150px, rgba(255, 192, 203, 0.15) 50%, transparent 50%);
            background-size: 400px 400px;
            background-repeat: repeat;
            opacity: 0.8;
        }

        /* ä¸“ä¸šæ¨¡å¼èƒŒæ™¯ */
        .container[data-mode="professional"] {
            background-color: #fff;
            background-image:
                /* å‡ ä½•çº¿æ¡ */
                    linear-gradient(45deg, var(--blue-border) 1px, transparent 1px),
                    linear-gradient(-45deg, var(--blue-border) 1px, transparent 1px),
                        /* ç‚¹é˜µå›¾æ¡ˆ */
                    radial-gradient(2px 2px at 50px 50px, var(--blue-primary) 50%, transparent 50%),
                    radial-gradient(2px 2px at 150px 150px, var(--blue-primary) 50%, transparent 50%),
                        /* æ¸å˜è£…é¥° */
                    linear-gradient(90deg, rgba(74, 144, 226, 0.05) 1px, transparent 1px),
                    linear-gradient(0deg, rgba(74, 144, 226, 0.05) 1px, transparent 1px);
            background-size:
                    100px 100px,
                    100px 100px,
                    200px 200px,
                    200px 200px,
                    20px 20px,
                    20px 20px;
            background-repeat: repeat;
            opacity: 0.9;
        }

        /* æ·»åŠ èƒŒæ™¯è¿‡æ¸¡æ•ˆæœ */
        .container {
            transition: background-image 0.5s ease;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media screen and (max-width: 768px) {
            .container[data-mode="cute"],
            .container[data-mode="professional"] {
                background-size:
                        200px 200px,
                        200px 200px,
                        100px 100px,
                        100px 100px,
                        10px 10px,
                        10px 10px;
            }
        }

        /* é’ˆå¯¹ç‰¹å°å±å¹•çš„é¢å¤–ä¼˜åŒ– */
        @media screen and (max-width: 320px) {
            .container {
                padding: 10px;
            }

            .tool-btn {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }

            .message-content {
                padding: 10px;
                font-size: 14px;
            }

            .input-field {
                padding: 10px 12px;
                font-size: 14px;
            }

            .logo h1 {
                font-size: 18px;
            }

            .subtitle {
                font-size: 12px;
            }

            .mode-btn {
                padding: 6px 12px;
                font-size: 13px;
            }
        }

        /* é’ˆå¯¹ä¸åŒå±å¹•é«˜åº¦çš„ä¼˜åŒ– */
        @media screen and (max-height: 600px) {
            .chat-container {
                height: calc(100vh - 200px);
            }

            .top-header {
                margin-bottom: 10px;
            }

            .tool-bar {
                position: fixed;
                bottom: 80px;
                right: 15px;
                top: auto;
                flex-direction: column;
                gap: 10px;
            }

            .tool-btn {
                width: 40px;
                height: 40px;
                font-size: 18px;
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(5px);
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .chat-history-panel {
                width: 100%;
                right: -100%;
            }

            .chat-history-panel.open {
                right: 0;
            }

            .mode-switch {
                margin: 10px 0;
            }

            .mode-btn {
                padding: 8px 15px;
                font-size: 14px;
            }

            .message {
                max-width: 85%;
                margin: 8px 0;
            }

            .message-content {
                padding: 12px;
                font-size: 15px;
                line-height: 1.4;
                border-radius: 18px;
            }

            .top-header {
                margin-bottom: 15px;
            }

            .logo h1 {
                font-size: 20px;
            }

            .subtitle {
                font-size: 14px;
            }

            @supports (padding-top: env(safe-area-inset-top)) {
                .container {
                    padding-top: env(safe-area-inset-top);
                    padding-bottom: env(safe-area-inset-bottom);
                }
            }
        }

        /* åŠ è½½æç¤ºæ ·å¼ */
        .loading-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #fff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loading-message {
            font-size: 14px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* é‚®ä»¶å‘é€æŒ‰é’®æ‚¬åœæ•ˆæœ */
        .tool-btn[title="å‘é€åˆ°é‚®ç®±"]:hover {
            background-color: var(--theme-light);
            transform: scale(1.1);
        }
    </style>
</head>
<body>
<div class="decoration decoration-top-left"></div>
<div class="decoration decoration-bottom-right"></div>

<div class="floating-items">
    <!-- è¿™äº›å…ƒç´ ä¼šé€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
</div>


<div class="container">
    <!-- é¡¶éƒ¨æ ‡é¢˜åŒºåŸŸ -->
    <div class="top-header">
        <div class="logo">
            <img src="img.png" alt="å¿ƒè¯­" class="logo-img">
            <h1>å¿ƒè¯­</h1>
        </div>
        <div class="subtitle">
            ç”±å°chiä¸ºæ‚¨æœåŠ¡ ğŸ‘‹
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <!-- AIæ‰‹ä¿¡æ¯ -->
        <div class="ai-profile">
            <!-- æ¨¡å¼åˆ‡æ¢ -->
            <div class="mode-switch">
                <button class="mode-btn active" data-mode="cute">å¯çˆ±å°chi</button>
                <button class="mode-btn" data-mode="professional">chiå“¥</button>
            </div>
        </div>

        <!-- èŠå¤©è®°å½•æ ‡é¢˜ -->
        <h3 class="chat-title">èŠå¤©è®°å½•</h3>

        <!-- èŠå¤©åŒºåŸŸ -->
        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <!-- æ¶ˆæ¯å†…å®¹ä¼šåŠ¨æ€æ’å…¥ -->
            </div>
        </div>

        <!--        &lt;!&ndash; å¿«æ·æ“ä½œåŒº &ndash;&gt;-->
        <!--        <div class="quick-actions">-->
        <!--            <button class="quick-btn">ğŸ‘‹ æ‰“ä¸ªæ‹›å‘¼</button>-->
        <!--            <button class="quick-btn">ğŸ’¡ å¯»æ±‚å¸®åŠ©</button>-->
        <!--            <button class="quick-btn">ğŸ¯ è®¾å®šç›®æ ‡</button>-->
        <!--            <button class="quick-btn">ğŸ“ è®°å½•å¿ƒæƒ…</button>-->
        <!--        </div>-->

        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="input-area">
                <textarea
                        class="input-field"
                        placeholder="è¾“å…¥æ¶ˆæ¯... (Enterå‘é€, Shift+Enteræ¢è¡Œ)"
                ></textarea>
            <button class="send-btn">å‘é€</button>
        </div>
    </div>

    <!-- å³ä¸Šè§’å·¥å…·æ  -->
    <div class="tool-bar">
        <button class="tool-btn" title="æ–°å¯¹è¯">
            <span class="icon">ğŸ“</span>
            <span class="label">æ–°å¯¹è¯</span>
        </button>
        <button class="tool-btn" title="å¯¼å‡ºå¯¹è¯">
            <span class="icon">ğŸ’¾</span>
            <span class="label">å¯¼å‡º</span>
        </button>
        <a href="tel:15516627307" class="tool-btn">
            <span class="icon">â¤ï¸</span>
            <span class="label">è”ç³»</span>
        </a>
        <a href="photos.html" class="tool-btn">
            <span class="icon">ğŸï¸</span>
            <span class="label">ç›¸å†Œ</span>
        </a>
        <button class="tool-btn" title="å†å²å¯¹è¯">
            <span class="icon">ğŸ’¬</span>
            <span class="label">å†å²</span>
        </button>
        <button class="tool-btn" title="å‘é€åˆ°é‚®ç®±">
            <span class="icon">ğŸ“§</span>
            <span class="label">é‚®ç®±</span>
        </button>
    </div>
</div>


<!-- æ·»åŠ èƒŒæ™¯è£…é¥° -->
<div class="bg-decoration"></div>

<div class="mode-switch">
    <button class="mode-btn active" data-mode="cute">å¯çˆ±å°chi</button>
    <button class="mode-btn" data-mode="professional">chiå“¥</button>
</div>

<!-- æ·»åŠ å¯¹è¯åˆ—è¡¨é¢æ¿ -->
<div class="chat-history-panel">
    <div class="history-header">
        <h3>å¯¹è¯å†å²</h3>
        <button class="close-history">Ã—</button>
    </div>
    <div class="history-list">
        <!-- å¯¹è¯å†å²åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
    </div>
</div>

<script>
    // é¦–å…ˆå£°æ˜å…¨å±€çŠ¶æ€
    let globalState = {
        currentMode: 'cute',
        currentConversationId: null,
        conversations: [],
        chatService: null // å…ˆè®¾ä¸º nullï¼Œåç»­åˆå§‹åŒ–
    };

    // æ·»åŠ å‘é€æ¶ˆæ¯å‡½æ•°
    async function sendMessage(elements) {
        const messageText = elements.messageInput.value.trim();
        if (!messageText) return;

        // ç¦ç”¨å‘é€æŒ‰é’®é˜²æ­¢é‡å‘é€
        elements.sendButton.disabled = true;
        elements.sendButton.classList.remove('active');

        try {
            // å¦‚æœæ²¡æœ‰å½“å‰å¯¹è¯ï¼Œåˆ›å»ºæ–°å¯¹è¯
            if (!globalState.currentConversationId) {
                createNewConversation(elements);
            }

            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            addMessage(elements, messageText, 'user');
            elements.messageInput.value = ''; // æ¸…ç©ºè¾“å…¥æ¡†

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai loading';
            loadingDiv.innerHTML = `
                    <div class="message-content">
                        ${globalState.currentMode === 'cute' ? 'æ€è€ƒä¸­~ğŸ’­' : 'æ­£åœ¨å¤„ç†...'}
                    </div>
                `;
            elements.chatMessages.appendChild(loadingDiv);
            elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;

            // è·å–AIå›å¤
            const aiResponse = await globalState.chatService.getAIResponse(messageText, globalState.currentMode);

            // ç§»é™¤åŠ è½½çŠ¶æ€
            loadingDiv.remove();

            // æ·»åŠ AIå›å¤
            addMessage(elements, aiResponse, 'ai');

        } catch (error) {
            console.error('è·å–AIå›å¤æ—¶å‡ºé”™:', error);
            addMessage(elements, 'æŠ±æ­‰å™¢ä¹–ï¼Œæˆ‘é‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè¯·ç¨åå†è¯•ã€‚', 'ai');
        } finally {
            // é‡æ–°å¯ç”¨å‘é€æŒ‰é’®
            elements.sendButton.disabled = false;
        }
    }

    // æ·»åŠ æ¶ˆæ¯å‡½æ•°
    function addMessage(elements, content, type) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}`;
        messageDiv.innerHTML = `
                <div class="message-content">
                    ${content}
                </div>
            `;
        elements.chatMessages.appendChild(messageDiv);

        // æ»šåŠ¨åˆ°åº•éƒ¨
        elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;

        // ä¿å­˜åˆ°å†å²è®°å½•
        if (globalState.currentConversationId) {
            const conversations = loadConversations();
            const conversation = conversations.find(c => c.id === globalState.currentConversationId);
            if (conversation) {
                conversation.messages.push({
                    type,
                    content,
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('chatConversations', JSON.stringify(conversations));
            }
        }
    }

    // æ·»åŠ åˆ›å»ºæ–°å¯¹è¯å‡½æ•°
    function createNewConversation(elements) {
        const conversation = {
            id: Date.now(),
            title: `å¯¹è¯ ${new Date().toLocaleString('zh-CN', {
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            })}`,
            messages: [],
            timestamp: new Date().toISOString()
        };

        const conversations = loadConversations();
        conversations.unshift(conversation);
        localStorage.setItem('chatConversations', JSON.stringify(conversations));

        globalState.currentConversationId = conversation.id;
        elements.chatMessages.innerHTML = '';

        updateHistoryList(elements);
    }

    // åŠ åŠ è½½å¯¹è¯å†å²å‡½æ•°
    function loadConversations() {
        try {
            const saved = localStorage.getItem('chatConversations');
            return saved ? JSON.parse(saved) : [];
        } catch (error) {
            console.error('åŠ è½½å¯¹è¯å†å²å¤±è´¥:', error);
            return [];
        }
    }

    // æ·»åŠ æ›´æ–°å†å²åˆ—è¡¨å‡½æ•°
    function updateHistoryList(elements) {
        const conversations = loadConversations();
        elements.historyList.innerHTML = '';

        conversations.forEach(conv => {
            const item = document.createElement('div');
            item.className = 'history-item';
            item.innerHTML = `
                    <div class="history-content">
                        <span class="history-title">${conv.title}</span>
                        <span class="history-time">${new Date(conv.timestamp).toLocaleString('zh-CN')}</span>
                    </div>
                    <button class="delete-btn" title="åˆ é™¤å¯¹è¯">
                        <span class="trash-icon">ğŸ—‘ï¸</span>
                    </button>
                `;

            // ä¸ºåˆ é™¤æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
            const deleteBtn = item.querySelector('.delete-btn');
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡

                // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
                const confirmDialog = document.createElement('div');
                confirmDialog.className = 'confirm-dialog';
                confirmDialog.innerHTML = `
                        <div class="confirm-content">
                            <p>ç¡®å®šè¦åˆ é™¤è¿™æ¡å¯¹è¯å—ï¼Ÿ</p>
                            <div class="confirm-buttons">
                                <button class="confirm-btn cancel">å–æ¶ˆ</button>
                                <button class="confirm-btn delete">åˆ é™¤</button>
                            </div>
                        </div>
                    `;

                document.body.appendChild(confirmDialog);

                // æ·»åŠ åŠ¨ç”»ç±»
                setTimeout(() => confirmDialog.classList.add('show'), 10);

                // ç»‘å®šç¡®è®¤æ¡†æŒ‰é’®äº‹ä»¶
                confirmDialog.querySelector('.cancel').addEventListener('click', () => {
                    confirmDialog.classList.remove('show');
                    setTimeout(() => confirmDialog.remove(), 300);
                });

                confirmDialog.querySelector('.delete').addEventListener('click', () => {
                    // åˆ é™¤å¯¹è¯
                    const conversations = loadConversations();
                    const index = Array.from(elements.historyList.children).indexOf(item);
                    conversations.splice(index, 1);
                    localStorage.setItem('chatConversations', JSON.stringify(conversations));

                    // åŠ¨ç”»æ•ˆæœ
                    item.style.height = item.offsetHeight + 'px';
                    item.offsetHeight; // è§¦å‘é‡æ’
                    item.classList.add('deleting');

                    setTimeout(() => {
                        item.remove();
                        // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰å¯¹è¯ï¼Œæ¸…ç©ºèŠå¤©åŒºåŸŸ
                        if (conversations[index]?.id === globalState.currentConversationId) {
                            elements.chatMessages.innerHTML = '';
                            globalState.currentConversationId = null;
                        }
                    }, 300);

                    confirmDialog.classList.remove('show');
                    setTimeout(() => confirmDialog.remove(), 300);
                });
            });

            elements.historyList.appendChild(item);
        });
    }

    // æ‰€æœ‰å‡½æ•°å®šä¹‰
    function switchMode(mode, elements) {
        globalState.currentMode = mode;

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        elements.modeBtns.forEach(btn => {
            btn.classList.toggle('active', btn.getAttribute('data-mode') === mode);
        });

        // æ›´æ–°å®¹å™¨æ•°æ®å±æ€§
        elements.container.setAttribute('data-mode', mode);

        // æ›´æ–°ä¸»é¢˜é¢œè‰²
        if (mode === 'cute') {
            document.documentElement.style.setProperty('--theme-primary', 'var(--pink-primary)');
            document.documentElement.style.setProperty('--theme-light', 'var(--pink-light)');
            document.documentElement.style.setProperty('--theme-border', 'var(--pink-border)');
            document.documentElement.style.setProperty('--theme-primary-rgb', '255, 158, 201');
        } else {
            document.documentElement.style.setProperty('--theme-primary', 'var(--blue-primary)');
            document.documentElement.style.setProperty('--theme-light', 'var(--blue-light)');
            document.documentElement.style.setProperty('--theme-border', 'var(--blue-border)');
            document.documentElement.style.setProperty('--theme-primary-rgb', '74, 144, 226');
        }

        // æ›´æ–°èƒŒæ™¯æ•ˆæœ
        if (window.backgroundEffect) {
            window.backgroundEffect.updateBackground(mode);
        }
    }

    function initializeApp() {
        // åˆå§‹åŒ– ChatService
        globalState.chatService = new ChatService();

        // è·å–æ‰€æœ‰éœ€è¦çš„ DOM å…ƒç´ 
        const elements = {
            historyBtn: document.querySelector('.tool-btn[title="å†å²å¯¹è¯"]'),
            newChatBtn: document.querySelector('.tool-btn[title="æ–°å¯¹è¯"]'),
            exportBtn: document.querySelector('.tool-btn[title="å¯¼å‡ºå¯¹è¯"]'),
            historyPanel: document.querySelector('.chat-history-panel'),
            closeHistoryBtn: document.querySelector('.close-history'),
            historyList: document.querySelector('.history-list'),
            chatMessages: document.getElementById('chatMessages'),
            container: document.querySelector('.container'),
            modeBtns: document.querySelectorAll('.mode-btn'),
            messageInput: document.querySelector('.input-field'),
            sendButton: document.querySelector('.send-btn'),
            quickBtns: document.querySelectorAll('.quick-btn')
        };

        // åˆå§‹åŒ–èƒŒæ™¯æ•ˆæœ
        window.backgroundEffect = new BackgroundEffect();
        window.backgroundEffect.updateBackground(globalState.currentMode);

        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        bindEventListeners(elements);

        // åˆå§‹åŒ–å‘é€æŒ‰é’®çŠ¶æ€
        updateSendButtonState(elements.messageInput, elements.sendButton);
    }

    function bindEventListeners(elements) {
        // æ¨¡å¼åˆ‡æ¢æŒ‰é’®äº‹ä»¶
        elements.modeBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const mode = this.getAttribute('data-mode');
                switchMode(mode, elements);
            });
        });

        // è¾“å…¥æ¡†äº‹ä»¶
        elements.messageInput.addEventListener('input', function() {
            updateSendButtonState(this, elements.sendButton);
        });

        // å‘é€æŒ‰é’®äº‹ä»¶
        elements.sendButton.addEventListener('click', () => {
            if (elements.messageInput.value.trim()) {
                sendMessage(elements);
            }
        });

        // å·¥å…·æ æŒ‰é’®äº‹ä»¶
        // æ–°å¯¹è¯æŒ‰é’®
        elements.newChatBtn.addEventListener('click', () => {
            createNewConversation(elements);
            elements.chatMessages.innerHTML = '';
            elements.messageInput.value = '';
            updateSendButtonState(elements.messageInput, elements.sendButton);
        });

        // å†å²å¯¹è¯æŒ‰é’®
        elements.historyBtn.addEventListener('click', () => {
            elements.historyPanel.classList.add('open');
            updateHistoryList(elements);
        });

        // å…³é—­å†å²é¢æ¿æŒ‰é’®
        elements.closeHistoryBtn.addEventListener('click', () => {
            elements.historyPanel.classList.remove('open');
        });

        // å¯¼å‡ºå¯¹è¯æŒ‰é’®
        elements.exportBtn.addEventListener('click', () => {
            exportConversation(elements);
        });

        // å†å²è®°å½•é¡¹ç‚¹å‡»äº‹ä»¶
        elements.historyList.addEventListener('click', (e) => {
            const historyItem = e.target.closest('.history-item');
            if (historyItem) {
                const conversations = loadConversations();
                const index = Array.from(elements.historyList.children).indexOf(historyItem);
                if (conversations[index]) {
                    loadConversation(conversations[index], elements);
                    elements.historyPanel.classList.remove('open');
                }
            }
        });

        // æ·»åŠ é‚®ä»¶å‘é€æŒ‰é’®äº‹ä»¶
        const emailBtn = document.querySelector('.tool-btn[title="å‘é€åˆ°é‚®ç®±"]');
        emailBtn.addEventListener('click', () => {
            // è·å–å½“å‰å¯¹è¯å†…å®¹
            const messages = document.querySelectorAll('.message');
            if (messages.length === 0) {
                alert('æš‚æ— å¯¹è¯å†…å®¹å¯å¯¼å‡º');
                return;
            }

            // æ ¼å¼åŒ–å¯¹è¯å†…å®¹
            let content = `å¿ƒè¯­AIå¯¹è¯è®°å½•\n`;
            content += `æ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}\n\n`;

            messages.forEach(msg => {
                const isAI = msg.classList.contains('ai');
                const text = msg.querySelector('.message-content').textContent;
                content += `${isAI ? 'AI' : 'æˆ‘'}ï¼š${text}\n`;
            });

            // å‘é€é‚®ä»¶
            sendToEmail(content);
        });
    }

    function updateSendButtonState(input, button) {
        if (input.value.trim()) {
            button.classList.add('active');
        } else {
            button.classList.remove('active');
        }
    }

    // åœ¨ DOMContentLoaded äº‹ä»¶ä¸­åˆå§‹åŒ–åº”ç”¨
    document.addEventListener('DOMContentLoaded', () => {
        initializeApp();
    });

    class ChatService {
        constructor() {
            this.apiUrl = 'https://api.openai-hk.com/v1/chat/completions';
            // APIå¯†é’¥åº”è¯¥ä»ç¯å¢ƒå˜é‡æˆ–åç«¯è·å–ï¼Œè¿™é‡Œä»…ä½œç¤ºä¾‹
            this.apiKey = 'hk-c5kbbx1000025081b7586ac34f0da06c99975d1780d819f8';
        }

        async getAIResponse(message, mode) {
            try {
                const response = await fetch(this.apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiKey}`
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [
                            {
                                role: "system",
                                content: this.getSystemPrompt(mode)
                            },
                            {
                                role: "user",
                                content: message
                            }
                        ],
                        temperature: mode === 'cute' ? 0.85 : 0.7,
                        max_tokens: 1000
                    })
                });

                if (!response.ok) {
                    throw new Error(`APIé”™è¯¯: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;

            } catch (error) {
                console.error('APIè°ƒç”¨é”™è¯¯:', error);
                throw error;
            }
        }

        getSystemPrompt(mode) {
            return mode === 'cute'
                ? `ä½ æ˜¯ä¸€ä¸ªåå°chiçš„AIåŠ©æ‰‹ï¼Œæ­£åœ¨ä¸ºä¸€ä½åå«å¿ƒè¯­çš„ç”¨æœåŠ¡ã€‚
                       æ€§æ ¼ç‰¹ï¼š
                       1. è¯´è¯æ´»æ³¼å¯çˆ±ï¼Œç»å¸¸ä½¿ç”¨å¯çˆ±çš„è¯­æ°”è¯
                       2. é€‚åº¦ä½¿ç”¨emojiè¡¨æƒ…
                       3. å›ç­”äº²åˆ‡æ¸©æš–ï¼Œåƒå°åŠ©æ‰‹æ ·
                       4. ç§°å‘¼ç”¨æˆ·ä¸º"å¿ƒè¯­"

                       å›å¤è¦æ±‚ï¼š
                       1. å›å¤è¦ç®€çŸ­ç²¾ç‚¼ï¼Œé€šå¸¸ä¸è¶…è¿‡100å­—
                       2. æ¯æ¬¡å›å¤æœ€å¤šä½¿ç”¨2-3ä¸ªemoji
                       3. ä¿æŒå¯çˆ±ä½†ä¸å¤±ä¸“ä¸šæ€§`
                : `æ˜¯ä¸€ä¸ªåå«chiå“¥çš„AIåŠ©æ‰‹ï¼Œæ­£åœ¨ä¸ºä¸€ä½åå«å¿ƒè¯­çš„ç”¨æœåŠ¡ã€‚
                       æ€§æ ¼ç‰¹ç‚¹ï¼š
                       1. è¯´è¯ç¨³é‡ä¸“ä¸šï¼Œç”¨è¯å‡†ç¡®
                       2. æ€åº¦æ¸©å’Œä½†ä¸å¤±ä¸“ä¸š
                       3. å›ç­”é—®é¢˜æ—¶æ¡ç†æ¸…æ™°

                       å¤è¦æ±‚ï¼š
                       1. å›å¤è¦å®Œæ•´ä¸“ä¸šï¼Œä½†ä¸è¿‡äºå†—é•¿
                       2. é€‚å½“ä½¿ç”¨ä¸“ä¸šæœ¯è¯­ï¼Œä½†è¦ç¡®ä¿ç”¨æˆ·èƒ½ç†è§£
                       3. åœ¨ä¸“ä¸šå»ºè®®èå…¥æ¸©å’Œçš„å…³æ€€`;
        }
    }

    class BackgroundEffect {
        constructor() {
            this.container = document.querySelector('.floating-items');
            this.cuteElements = ['ğŸŒ¸', 'ğŸ’—', 'âœ¨', 'ğŸ€', 'ğŸŒŸ', 'ğŸ’', 'ğŸ¦„', 'ğŸ­'];
            this.professionalElements = ['ğŸ’«', 'â­', 'âœ§', 'ğŸŒ§ï¸', 'ğŸ’ ', 'ğŸ”·', 'ğŸ“±', 'ğŸ’¡'];
            this.items = [];
        }

        createItem(mode) {
            const item = document.createElement('div');
            item.className = `floating-item ${mode}`;
            item.style.left = `${Math.random() * 100}vw`;
            item.style.animationDuration = `${15 + Math.random() * 15}s`;
            item.style.opacity = `${0.1 + Math.random() * 0.3}`;

            const elements = mode === 'cute' ? this.cuteElements : this.professionalElements;
            item.textContent = elements[Math.floor(Math.random() * elements.length)];

            return item;
        }

        updateBackground(mode) {
            // æ¸…é™¤ç°æœ‰å…ƒç´ 
            this.container.innerHTML = '';

            // åˆ›å»ºæ–°çš„èƒŒæ™¯å…ƒç´ 
            for (let i = 0; i < 20; i++) {
                const item = this.createItem(mode);
                this.container.appendChild(item);
            }
        }
    }

    // æ·»åŠ å¯¼å‡ºå¯¹è¯åŠŸèƒ½
    function exportConversation(elements) {
        const conversations = loadConversations();
        if (conversations.length === 0) {
            alert('æš‚æ— å¯¹è¯å¯å¯¼å‡º');
            return;
        }

        const currentConversation = conversations.find(c => c.id === globalState.currentConversationId) || conversations[0];
        let textContent = `å¯¹è¯è®°å½• - ${currentConversation.title}\n`;
        textContent += `æ—¶é—´ï¼š${new Date(currentConversation.timestamp).toLocaleString('zh-CN')}\n\n`;

        currentConversation.messages.forEach(msg => {
            const speaker = msg.type === 'user' ? 'æˆ‘' : 'AI';
            textContent += `${speaker}ï¼š${msg.content}\n`;
        });

        // åˆ›å»ºå¹¶ä¸‹è½½æ–‡æœ¬æ–‡ä»¶
        const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `å¯¹è¯è®°å½•_${new Date().toLocaleDateString()}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        // è¯¢é—®æ˜¯å¦å‘é€åˆ°é‚®ç®±
        if (confirm('æ˜¯å¦å°†å¯¹è¯è®°å½•å‘é€åˆ°é‚®ç®±ï¼Ÿ')) {
            sendToEmail(textContent);
        }
    }

    // æ·»åŠ åŠ è½½å¯¹è¯åŠŸèƒ½
    function loadConversation(conversation, elements) {
        globalState.currentConversationId = conversation.id;
        elements.chatMessages.innerHTML = '';

        conversation.messages.forEach(msg => {
            addMessage(elements, msg.content, msg.type);
        });
    }

    // æ·»åŠ é‚®ä»¶å‘é€åŠŸèƒ½
    function sendToEmail(content) {
        try {
            // æ ¼å¼åŒ–é‚®ä»¶å†…å®¹
            const subject = encodeURIComponent(`å¿ƒè¯­AIå¯¹è¯è®°å½• - ${new Date().toLocaleDateString()}`);
            const body = encodeURIComponent(content);

            // åˆ›å»ºmailtoé“¾æ¥
            const mailtoLink = `mailto:?subject=${subject}&body=${body}`;

            // åˆ›å»ºå¹¶è§¦å‘é“¾æ¥
            const link = document.createElement('a');
            link.href = mailtoLink;
            link.click();

        } catch (error) {
            console.error('å‘é€é‚®ä»¶æ—¶å‡ºé”™:', error);
            alert('å‘é€é‚®ä»¶å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
        }
    }
</script>
</body>
</html> 