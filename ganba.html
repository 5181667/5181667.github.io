<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>干噎酸奶(Greek Yogurt) 极致口感研究实验室</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Noto Sans SC', 'sans-serif'],
                    },
                    colors: {
                        yogurt: {
                            50: '#F9FAFB',
                            100: '#F3F4F6',
                            200: '#E5E7EB',
                            300: '#D1D5DB',
                            500: '#6B7280',
                            800: '#1F2937',
                        },
                        cream: {
                            100: '#FFFDF5',
                            200: '#FEF3C7',
                            500: '#F59E0B',
                        },
                        brand: {
                            blue: '#3B82F6',
                            dark: '#1e3a8a'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #FAFAF9; /* Warm neutral background */
            color: #1F2937;
        }
        
        /* Chart Container Styling per Requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 650px; /* Max width to prevent excessive stretching */
            margin-left: auto;
            margin-right: auto;
            height: 350px; /* Base height */
            max-height: 400px;
        }

        @media (max-width: 768px) {
            .chart-container {
                height: 280px; /* Smaller height for mobile */
            }
        }

        /* Hide scrollbar for clean UI */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .nav-item.active {
            border-bottom: 2px solid #3B82F6;
            color: #1e3a8a;
            font-weight: 700;
        }
        
        .timeline-line {
            position: absolute;
            left: 24px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #E5E7EB;
            z-index: 0;
        }
    </style>
</head>
<body class="font-sans antialiased selection:bg-brand-blue selection:text-white">

    <!-- App Container -->
    <div id="app" class="min-h-screen flex flex-col max-w-7xl mx-auto bg-white shadow-xl overflow-hidden">
        
        <!-- Header -->
        <header class="bg-white border-b border-gray-100 p-4 sticky top-0 z-50">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 bg-brand-dark rounded-full flex items-center justify-center text-white font-bold">Y</div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800 tracking-tight">干噎酸奶研究室</h1>
                        <p class="text-xs text-gray-500">The Science of Thick Yogurt</p>
                    </div>
                </div>
                <div class="text-xs font-medium px-2 py-1 bg-cream-200 text-yellow-800 rounded">
                    BETA v1.0
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex space-x-6 mt-4 overflow-x-auto no-scrollbar pb-1">
                <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-item active whitespace-nowrap px-1 pb-2 text-sm text-gray-500 hover:text-gray-700 transition-colors">
                    数据总览
                </button>
                <button onclick="switchTab('science')" id="nav-science" class="nav-item whitespace-nowrap px-1 pb-2 text-sm text-gray-500 hover:text-gray-700 transition-colors">
                    关键变量分析
                </button>
                <button onclick="switchTab('process')" id="nav-process" class="nav-item whitespace-nowrap px-1 pb-2 text-sm text-gray-500 hover:text-gray-700 transition-colors">
                    工艺流程优化
                </button>
                <button onclick="switchTab('troubleshoot')" id="nav-troubleshoot" class="nav-item whitespace-nowrap px-1 pb-2 text-sm text-gray-500 hover:text-gray-700 transition-colors">
                    口感诊断
                </button>
            </nav>
        </header>

        <!-- Main Content Area -->
        <main class="flex-grow p-4 md:p-8 bg-yogurt-50 overflow-y-auto">

            <!-- VIEW: DASHBOARD -->
            <section id="dashboard-view" class="space-y-8 animate-fade-in">
                <!-- Intro Context -->
                <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                    <h2 class="text-lg font-bold text-gray-800 mb-2">什么是“干噎”口感？</h2>
                    <p class="text-gray-600 leading-relaxed text-sm">
                        “干噎”并非贬义，而是酸奶爱好者对极高粘度、低水分、高蛋白含量的希腊酸奶（Greek Yogurt）或乳清滤出酸奶（Strained Yogurt）的极致追求。
                        本研究报告通过量化分析，揭示了影响酸奶质地的核心要素：<strong>乳清去除率</strong>、<strong>蛋白质变性程度</strong>以及<strong>发酵酸度平衡</strong>。
                        在此页面，您可以探索如何通过控制这些变量来制作出口感如奶油奶酪般醇厚的酸奶。
                    </p>
                </div>

                <!-- KPI Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-blue-500">
                        <div class="text-xs text-gray-500 uppercase">理想蛋白质含量</div>
                        <div class="text-2xl font-bold text-gray-800">10g+<span class="text-sm font-normal">/100g</span></div>
                        <div class="text-xs text-green-600 mt-1">普通酸奶的3倍</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-yellow-500">
                        <div class="text-xs text-gray-500 uppercase">最佳过滤时长</div>
                        <div class="text-2xl font-bold text-gray-800">8-12<span class="text-sm font-normal">小时</span></div>
                        <div class="text-xs text-gray-400 mt-1">冷藏环境</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-red-500">
                        <div class="text-xs text-gray-500 uppercase">目标 pH 值</div>
                        <div class="text-2xl font-bold text-gray-800">4.5-4.6</div>
                        <div class="text-xs text-gray-400 mt-1">凝乳关键点</div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-sm border-l-4 border-indigo-500">
                        <div class="text-xs text-gray-500 uppercase">推荐发酵温度</div>
                        <div class="text-2xl font-bold text-gray-800">41-43<span class="text-sm font-normal">°C</span></div>
                        <div class="text-xs text-gray-400 mt-1">嗜热链球菌活跃区</div>
                    </div>
                </div>

                <!-- Chart: Viscosity vs Straining Time -->
                <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                    <div class="mb-4">
                        <h3 class="font-bold text-gray-800">过滤时间与质地变化关系</h3>
                        <p class="text-sm text-gray-500">乳清排出量直接决定了酸奶的干物质含量（“干噎”程度）。数据基于4°C冷藏过滤环境。</p>
                    </div>
                    <div class="chart-container">
                        <canvas id="strainingChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- VIEW: SCIENCE (Variables) -->
            <section id="science-view" class="hidden space-y-8 animate-fade-in">
                <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                    <h2 class="text-lg font-bold text-gray-800 mb-2">发酵动力学分析</h2>
                    <p class="text-gray-600 text-sm mb-4">
                        了解酸度（pH）随时间的变化至关重要。过酸会导致乳清析出过多（质地粗糙），酸度不够则凝乳不牢固。
                        下方图表展示了在42°C恒温下的理想发酵曲线。
                    </p>
                    <!-- Interactive Slider -->
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">模拟环境温度: <span id="temp-display">42</span>°C</label>
                        <input type="range" min="30" max="45" value="42" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-brand-blue" id="tempSlider">
                        <p class="text-xs text-gray-500 mt-2">拖动滑块查看不同温度对发酵速度（达到pH 4.6所需时间）的影响。</p>
                    </div>
                    <div class="chart-container">
                        <canvas id="phChart"></canvas>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Plotly 3D or Bubble Chart Container -->
                    <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm">
                        <h3 class="font-bold text-gray-800 mb-2">原料成分对成品率的影响</h3>
                        <p class="text-sm text-gray-500 mb-4">气泡大小代表成品“干噎”酸奶的预估产出量 (g)。</p>
                        <div class="chart-container">
                            <div id="plotlyYieldChart" class="w-full h-full"></div>
                        </div>
                    </div>
                    
                    <!-- Text based insights -->
                    <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col justify-center">
                        <h3 class="font-bold text-gray-800 mb-4">核心原理总结</h3>
                        <ul class="space-y-4">
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">1</span>
                                <div>
                                    <p class="text-sm font-bold text-gray-800">蛋白质热变性</p>
                                    <p class="text-xs text-gray-500">将牛奶加热至85°C并保持10-20分钟，使乳清蛋白变性并与酪蛋白结合，这是形成致密凝胶网络的关键。</p>
                                </div>
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">2</span>
                                <div>
                                    <p class="text-sm font-bold text-gray-800">物理浓缩（过滤）</p>
                                    <p class="text-xs text-gray-500">普通的希腊式酸奶需要去除约2/3的乳清重量。每1000g牛奶最终仅产出约300-350g“干噎”酸奶。</p>
                                </div>
                            </li>
                            <li class="flex items-start">
                                <span class="flex-shrink-0 w-6 h-6 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xs font-bold mr-3">3</span>
                                <div>
                                    <p class="text-sm font-bold text-gray-800">后熟作用</p>
                                    <p class="text-xs text-gray-500">过滤后的酸奶需在冰箱冷藏钝化12-24小时，风味物质（如丁二酮）会进一步融合，质地更加顺滑。</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- VIEW: PROCESS (Interactive Guide) -->
            <section id="process-view" class="hidden animate-fade-in">
                <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm mb-6">
                    <h2 class="text-lg font-bold text-gray-800 mb-2">SOP 标准作业程序</h2>
                    <p class="text-gray-600 text-sm">点击下方步骤卡片，查看实现“干噎”口感的详细操作参数。</p>
                </div>

                <div class="relative pl-4 md:pl-8 space-y-8">
                    <div class="timeline-line"></div>

                    <!-- Step 1 -->
                    <div class="relative pl-8 cursor-pointer group" onclick="toggleStep('step1')">
                        <div class="absolute left-0 w-12 h-12 bg-white border-2 border-brand-blue rounded-full flex items-center justify-center z-10 group-hover:scale-110 transition-transform shadow-sm">
                            <span class="text-xl">🔥</span>
                        </div>
                        <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-100 hover:border-brand-blue transition-colors">
                            <h3 class="font-bold text-gray-800 flex justify-between items-center">
                                步骤 1: 预热变性 (85°C)
                                <span class="text-xs text-brand-blue font-normal bg-blue-50 px-2 py-1 rounded">关键步骤</span>
                            </h3>
                            <div id="step1" class="hidden mt-3 text-sm text-gray-600 border-t border-gray-100 pt-3">
                                <p class="mb-2"><strong>目的：</strong>使乳清蛋白变性，增加持水性，构建更紧密的蛋白质网状结构。</p>
                                <p><strong>操作：</strong>将牛奶缓慢加热至82-85°C，保持15-20分钟。注意搅拌防糊底。这比普通酸奶加热步骤更激进，但对厚度至关重要。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2 -->
                    <div class="relative pl-8 cursor-pointer group" onclick="toggleStep('step2')">
                        <div class="absolute left-0 w-12 h-12 bg-white border-2 border-brand-blue rounded-full flex items-center justify-center z-10 group-hover:scale-110 transition-transform shadow-sm">
                            <span class="text-xl">🌡️</span>
                        </div>
                        <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-100 hover:border-brand-blue transition-colors">
                            <h3 class="font-bold text-gray-800">步骤 2: 降温接种 (42-43°C)</h3>
                            <div id="step2" class="hidden mt-3 text-sm text-gray-600 border-t border-gray-100 pt-3">
                                <p class="mb-2"><strong>操作：</strong>迅速降温至43°C左右。这是嗜热链球菌和保加利亚乳杆菌的最佳繁殖温度。</p>
                                <p><strong>干噎秘诀：</strong>加入少量淡奶油（10%比例）或脱脂奶粉与菌粉混合，可大幅提升最终固形物含量。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3 -->
                    <div class="relative pl-8 cursor-pointer group" onclick="toggleStep('step3')">
                        <div class="absolute left-0 w-12 h-12 bg-white border-2 border-brand-blue rounded-full flex items-center justify-center z-10 group-hover:scale-110 transition-transform shadow-sm">
                            <span class="text-xl">🦠</span>
                        </div>
                        <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-100 hover:border-brand-blue transition-colors">
                            <h3 class="font-bold text-gray-800">步骤 3: 恒温发酵 (8-10小时)</h3>
                            <div id="step3" class="hidden mt-3 text-sm text-gray-600 border-t border-gray-100 pt-3">
                                <p class="mb-2"><strong>判断终点：</strong>不要只看时间。观察酸奶表面是否有少量乳清析出，且倾斜容器时凝乳呈布丁状整体移动。</p>
                                <p><strong>注意：</strong>过度发酵会导致酸度过高，虽然利于乳清析出，但口感会变得粗糙。</p>
                            </div>
                        </div>
                    </div>

                    <!-- Step 4 -->
                    <div class="relative pl-8 cursor-pointer group" onclick="toggleStep('step4')">
                        <div class="absolute left-0 w-12 h-12 bg-white border-2 border-brand-dark rounded-full flex items-center justify-center z-10 group-hover:scale-110 transition-transform shadow-sm">
                            <span class="text-xl text-white">💧</span>
                        </div>
                        <div class="bg-white p-5 rounded-lg shadow-sm border border-brand-dark border-l-4 transition-colors">
                            <h3 class="font-bold text-gray-800">步骤 4: 低温过滤 (核心步骤)</h3>
                            <div id="step4" class="block mt-3 text-sm text-gray-600 border-t border-gray-100 pt-3">
                                <p class="mb-2"><strong>这是制作“干噎”酸奶的灵魂。</strong></p>
                                <p class="mb-2"><strong>工具：</strong>咖啡滤纸、细纱布或专用希腊酸奶过滤器。</p>
                                <p class="mb-2"><strong>环境：</strong>必须在冰箱冷藏室进行（防止杂菌滋生和过度酸化）。</p>
                                <ul class="list-disc pl-4 space-y-1 text-xs bg-gray-50 p-2 rounded">
                                    <li>过滤 4小时：浓稠酸奶状</li>
                                    <li>过滤 8小时：希腊酸奶状（推荐）</li>
                                    <li>过滤 12小时：奶油奶酪状（极干）</li>
                                    <li>过滤 24小时：酸奶球（需浸泡橄榄油保存）</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VIEW: TROUBLESHOOT -->
            <section id="troubleshoot-view" class="hidden animate-fade-in">
                <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm mb-6">
                    <h2 class="text-lg font-bold text-gray-800 mb-2">口感诊断器</h2>
                    <p class="text-gray-600 text-sm">选择您的酸奶出现的状况，获取调整建议。</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6" id="symptom-buttons">
                    <!-- Buttons generated by JS -->
                </div>

                <div id="diagnosis-card" class="bg-cream-100 border border-cream-200 p-6 rounded-xl hidden">
                    <div class="flex items-start gap-4">
                        <div class="text-3xl">💡</div>
                        <div>
                            <h3 class="font-bold text-gray-900 text-lg mb-2" id="diagnosis-title">诊断结果</h3>
                            <p class="text-gray-700 text-sm leading-relaxed" id="diagnosis-text">...</p>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        // --- State Management ---
        const state = {
            currentTab: 'dashboard',
            tempSliderValue: 42,
            symptoms: [
                {
                    id: 'grainy',
                    label: '口感粗糙/有颗粒',
                    title: '蛋白质凝固过快或酸化过度',
                    solution: '1. 降温速度过慢，导致局部过度发酵。建议冰水浴迅速降温。<br>2. 发酵温度过高（>45°C）导致菌种生长过快，凝乳粗糙。<br>3. 搅拌了正在发酵中的酸奶（破坏了凝胶结构）。'
                },
                {
                    id: 'runny',
                    label: '不够干/太稀',
                    title: '固形物含量不足或发酵不充分',
                    solution: '1. 过滤时间不足，乳清残留过多。请延长过滤至8小时以上。<br>2. 蛋白质含量低。尝试添加脱脂奶粉或使用全脂牛奶。<br>3. 菌种活力不足，发酵未达终点（pH未降至4.6）。'
                },
                {
                    id: 'sour',
                    label: '太酸/刺喉',
                    title: '后酸化严重',
                    solution: '1. 发酵时间过长。一旦凝固应立即放入冰箱。<br>2. 过滤过程未在冰箱进行。高温下菌种持续产酸。<br>3. 菌种比例：保加利亚乳杆菌产酸能力强，尝试调整菌种或减少接种量。'
                },
                {
                    id: 'ropiness',
                    label: '拉丝/粘液状',
                    title: '菌种产粘或低温发酵',
                    solution: '1. 发酵温度过低（<38°C），导致产粘菌株活跃。<br>2. 某些商用菌粉特意添加了产粘菌株（如用于饮用型酸奶）。制作干噎酸奶请选用“希腊酸奶专用”菌粉。'
                }
            ]
        };

        // --- Data Storage ---
        const data = {
            straining: {
                labels: ['0h', '2h', '4h', '8h', '12h', '24h'],
                viscosity: [20, 35, 55, 85, 95, 100], // Hypothetical viscosity score
                yield: [1000, 800, 600, 400, 350, 300] // Weight remaining from 1000g milk
            },
            fermentation: {
                baseLabels: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10], // Hours
                basePh: [6.6, 6.5, 6.3, 5.9, 5.4, 5.0, 4.8, 4.65, 4.6, 4.55, 4.5]
            },
            yieldBubble: {
                // x: Fat%, y: Protein%, size: Yield
                x: [3.5, 0, 4.0, 3.5, 6.0], 
                y: [3.2, 3.2, 3.4, 4.5, 3.8],
                z: [350, 300, 380, 450, 420], // Yield in grams
                labels: ['全脂牛奶', '脱脂牛奶', '水牛奶', '加奶粉', '加淡奶油']
            }
        };

        // --- Core Interaction Handling ---

        function switchTab(tabId) {
            // Update State
            state.currentTab = tabId;

            // Update UI: Nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${tabId}`).classList.add('active');

            // Update UI: Views
            ['dashboard', 'science', 'process', 'troubleshoot'].forEach(view => {
                const el = document.getElementById(`${view}-view`);
                if (view === tabId) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            });

            // Trigger chart resize/render if needed when tab becomes visible
            if (tabId === 'dashboard') {
                // Ensure chart renders correctly after hidden
                if(window.strainingChartInst) window.strainingChartInst.resize();
            }
            if (tabId === 'science') {
                if(window.phChartInst) window.phChartInst.resize();
                Plotly.relayout('plotlyYieldChart', {autosize: true});
            }
        }

        function toggleStep(stepId) {
            const el = document.getElementById(stepId);
            el.classList.toggle('hidden');
        }

        function renderSymptomButtons() {
            const container = document.getElementById('symptom-buttons');
            container.innerHTML = state.symptoms.map(sym => `
                <button onclick="diagnose('${sym.id}')" 
                    class="p-4 border rounded-lg hover:bg-blue-50 hover:border-blue-300 transition-all text-left">
                    <div class="font-bold text-gray-700">${sym.label}</div>
                </button>
            `).join('');
        }

        function diagnose(id) {
            const symptom = state.symptoms.find(s => s.id === id);
            const card = document.getElementById('diagnosis-card');
            const title = document.getElementById('diagnosis-title');
            const text = document.getElementById('diagnosis-text');

            title.innerText = symptom.title;
            text.innerHTML = symptom.solution;
            
            card.classList.remove('hidden');
            card.classList.add('animate-fade-in');
        }

        // --- Chart Implementation ---

        function initCharts() {
            // 1. Straining Chart (Dashboard) - Mixed Chart
            const ctxStraining = document.getElementById('strainingChart').getContext('2d');
            window.strainingChartInst = new Chart(ctxStraining, {
                type: 'bar',
                data: {
                    labels: data.straining.labels,
                    datasets: [
                        {
                            label: '质地紧实度 (0-100)',
                            data: data.straining.viscosity,
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            yAxisID: 'y',
                        },
                        {
                            label: '剩余重量 (g/1000g原料)',
                            data: data.straining.yield,
                            type: 'line',
                            borderColor: '#F59E0B',
                            borderWidth: 2,
                            yAxisID: 'y1',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: { position: 'left', title: {display: true, text: '紧实度'} },
                        y1: { position: 'right', title: {display: true, text: '重量(g)'}, grid: {drawOnChartArea: false} }
                    }
                }
            });

            // 2. pH Chart (Science) - Dynamic Line Chart
            const ctxPh = document.getElementById('phChart').getContext('2d');
            window.phChartInst = new Chart(ctxPh, {
                type: 'line',
                data: {
                    labels: data.fermentation.baseLabels,
                    datasets: [{
                        label: 'pH 值变化',
                        data: data.fermentation.basePh,
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: 4.6,
                                    yMax: 4.6,
                                    borderColor: 'green',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: { content: '凝乳临界点', enabled: true }
                                }
                            }
                        }
                    },
                    scales: {
                        y: { title: {display: true, text: 'pH (酸度)'}, min: 4.0, max: 7.0 },
                        x: { title: {display: true, text: '发酵时长 (小时)'} }
                    }
                }
            });

            // 3. Plotly Bubble Chart (Science)
            const trace1 = {
                x: data.yieldBubble.x,
                y: data.yieldBubble.y,
                text: data.yieldBubble.labels,
                mode: 'markers',
                marker: {
                    size: data.yieldBubble.z.map(z => z / 8), // Scale size
                    color: data.yieldBubble.z,
                    colorscale: 'YlOrRd',
                    showscale: true,
                    colorbar: { title: '产出量(g)' }
                },
                hovertemplate: '<b>%{text}</b><br>脂肪: %{x}%<br>蛋白质: %{y}%<br>预估产出: %{marker.color}g<extra></extra>'
            };

            const layout = {
                title: false,
                xaxis: { title: '原料脂肪含量 (%)' },
                yaxis: { title: '原料蛋白质含量 (%)' },
                margin: { t: 20, l: 40, r: 20, b: 40 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                showlegend: false
            };
            
            // Note: Plotly needs the container ID, not canvas
            Plotly.newPlot('plotlyYieldChart', [trace1], layout, {responsive: true, displayModeBar: false});
        }

        // --- Logic: Simulation (Temp Slider) ---
        
        document.getElementById('tempSlider').addEventListener('input', function(e) {
            const temp = parseInt(e.target.value);
            document.getElementById('temp-display').innerText = temp;
            
            // Simulation Logic:
            // Optimal temp is 42. Higher temp = faster drop initially but risk of graininess.
            // Lower temp = slower drop.
            // We simulate this by stretching or compressing the x-axis logic slightly for visual effect
            
            const optimal = 42;
            const factor = 1 + (optimal - temp) * 0.1; // If temp is 30, factor is 2.2 (slower). If temp is 45, factor is 0.7 (faster)
            
            const newLabels = data.fermentation.baseLabels.map(t => (t * factor).toFixed(1));
            
            window.phChartInst.data.labels = newLabels;
            window.phChartInst.update();
        });


        // --- Initialization ---
        window.addEventListener('DOMContentLoaded', () => {
            initCharts();
            renderSymptomButtons();
            
            // Add fade-in animation class to style
            const style = document.createElement('style');
            style.innerHTML = `
                .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
                @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            `;
            document.head.appendChild(style);
        });

    </script>
</body>

<!-- Chosen Palette: Creamy Neutral with Medical Blue. Background: #FAFAF9 (Stone-50), Text: #1F2937 (Gray-800), Primary Accent: #3B82F6 (Blue-500) for science/trust, Secondary Accent: #F59E0B (Amber-500) for dairy richness. This reflects the clean, scientific nature of the "lab" while maintaining food appeal. -->

<!-- Application Structure Plan: 
    1. Navigation: Tab-based architecture (Dashboard, Science, Process, Troubleshoot) chosen to separate the "What" (Results), "Why" (Science), "How" (Steps), and "Fix" (Help). This allows non-linear exploration.
    2. Dashboard: Immediate value. Shows the metrics that define "Dry Yogurt" (Protein, Time, pH) and the core visualization (Straining Time) immediately.
    3. Science View: Interactive "Variable Lab". Users can play with temperature to see fermentation impact. Bubble chart shows ingredient relationships.
    4. Process View: Vertical Timeline. Chosen because a recipe is linear, but "Expandable details" keeps the UI clean until the user needs specific instruction.
    5. Troubleshoot: Interactive Click-to-Diagnose. More engaging than a static FAQ table.
-->

<!-- Visualization & Content Choices:
    1. Straining Chart (Chart.js Bar+Line): Goal: Show trade-off between Yield and Texture. Interaction: Hover to see exact values. Justification: Dual-axis chart perfectly illustrates "Loss of weight = Gain of texture".
    2. pH Curve (Chart.js Line): Goal: Visualize fermentation speed. Interaction: Slider controls the "Temperature" variable, updating the X-axis time. Justification: Temperature is the hardest variable for home brewers to control; simulating its effect teaches the concept.
    3. Ingredient Bubble Chart (Plotly): Goal: Compare milk types. Interaction: Hover for details. Justification: 3 dimensions needed (Fat, Protein, Yield), bubbles work best for categorical comparison of ingredients.
    4. Process Timeline (HTML/Tailwind): Goal: Step-by-step instruction. Interaction: Click to expand details. Justification: Text-heavy instruction needs progressive disclosure to avoid overwhelming the user.
-->

<!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. All icons are text/Unicode or CSS shapes. Charts use Canvas. -->

</html>